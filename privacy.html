<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BanterBox - Privacy Policy</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
    body {
      background: linear-gradient(to bottom, #f9f9f9, #e5e7eb);
      font-family: 'Inter', 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      transition: background 0.3s ease, font-size 0.3s ease;
      overscroll-behavior: none;
    }
    body.dark {
      background: linear-gradient(to bottom, #1f2937, #111827);
      color: #e5e7eb;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }
    .header {
      background: linear-gradient(white, white) padding-box,
                  linear-gradient(to right, #ef4444, #f97316) border-box;
      border-bottom: 2px solid transparent;
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .header.dark {
      background: linear-gradient(#374151, #374151) padding-box,
                  linear-gradient(to right, #dc2626, #f97316) border-box;
      color: #e5e7eb;
    }
    .content {
      background: linear-gradient(white, white) padding-box,
                  linear-gradient(to right, #ef4444, #f97316) border-box;
      border: 2px solid transparent;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin-bottom: 1.5rem;
      transition: background 0.3s ease;
    }
    .content.dark {
      background: linear-gradient(#374151, #374151) padding-box,
                  linear-gradient(to right, #dc2626, #f97316) border-box;
      color: #e5e7eb;
    }
    h1 {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 1rem;
      color: #1f2937;
    }
    h1.dark {
      color: #e5e7eb;
    }
    h2 {
      font-size: 1.25rem;
      font-weight: 600;
      margin: 1.5rem 0 0.5rem;
      color: #1f2937;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: color 0.3s ease;
    }
    h2:hover {
      color: #ef4444;
    }
    h2.dark {
      color: #e5e7eb;
    }
    h2.dark:hover {
      color: #f87171;
    }
    p {
      margin-bottom: 1rem;
      color: #374151;
    }
    p.dark {
      color: #d1d5db;
    }
    ul {
      list-style-type: disc;
      margin-left: 1.5rem;
      margin-bottom: 1rem;
      color: #374151;
    }
    ul.dark {
      color: #d1d5db;
    }
    .link {
      color: #ef4444;
      text-decoration: none;
      font-weight: 500;
      position: relative;
      transition: color 0.3s ease;
    }
    .link::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(239, 68, 68, 0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.4s ease, height 0.4s ease;
    }
    .link:active::after {
      width: 100px;
      height: 100px;
    }
    .link:hover {
      color: #dc2626;
      text-decoration: underline;
    }
    .link.dark {
      color: #f87171;
    }
    .link.dark:hover {
      color: #ef4444;
    }
    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .section-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .section-content[aria-expanded="true"] {
      max-height: 1000px;
    }
    .toggle-icon {
      width: 1rem;
      height: 1rem;
      transition: transform 0.3s ease;
    }
    .toggle-icon[aria-expanded="true"] {
      transform: rotate(90deg);
    }
    .toggle {
      position: relative;
      display: inline-block;
      width: 48px;
      height: 24px;
    }
    .toggle input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #d1d5db;
      transition: 0.3s;
      border-radius: 24px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 2px;
      bottom: 2px;
      background: white;
      transition: 0.3s;
      border-radius: 50%;
    }
    input:checked + .slider {
      background: #ef4444;
    }
    input:checked + .slider:before {
      transform: translateX(24px);
    }
    .slider:hover {
      background: #9ca3af;
    }
    input:checked + .slider:hover {
      background: #dc2626;
    }
    .contact-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1.5rem;
    }
    .input-field {
      background: #f9fafb;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      padding: 0.75rem;
      width: 100%;
      font-size: 1rem;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .input-field.dark {
      background: #4b5563;
      border-color: #6b7280;
      color: #e5e7eb;
    }
    .input-field:focus {
      outline: none;
      border-color: #ef4444;
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
    }
    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      position: relative;
      overflow: hidden;
      transition: background-color 0.3s ease, transform 0.2s ease;
      min-height: 44px;
    }
    .btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.4s ease, height 0.4s ease;
    }
    .btn:active::after {
      width: 200px;
      height: 200px;
    }
    .btn:hover {
      transform: translateY(-2px);
    }
    .btn-primary {
      background: #ef4444;
      color: white;
    }
    .btn-primary:hover {
      background: #dc2626;
    }
    .error-message {
      font-size: 0.8rem;
      color: #ef4444;
      margin-top: 0.5rem;
      text-align: center;
      display: none;
      animation: fadeIn 0.3s ease;
    }
    .error-message.show {
      display: block;
    }
    .error-message button {
      color: #ef4444;
      text-decoration: underline;
      cursor: pointer;
      background: none;
      border: none;
      margin-left: 0.5rem;
    }
    .error-message.dark button {
      color: #dc2626;
    }
  </style>
</head>
<body>
  <div class="container fade-in">
    <header class="header dark:header">
      <button onclick="location.href='settings.html'" class="text-red-500 font-bold hover:text-red-600 flex items-center gap-2" aria-label="Back to settings">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Back to Settings
      </button>
      <h1 class="text-xl font-bold text-gray-900 dark:text-gray-100">Privacy Policy</h1>
      <div class="w-5"></div>
    </header>

    <div class="content dark:content" role="main">
      <h1 class="dark:dark">Privacy Policy</h1>
      <p class="dark:dark">Last updated: July 2, 2025</p>
      <p class="dark:dark">
        BanterBox, operated by My Two Minutes PTY ("we," "us," or "our"), is committed to protecting your privacy. This Privacy Policy explains how we collect, use, store, protect, and share your personal information when you use our website, mobile application, or related services (collectively, "Services"). By using our Services, you consent to the practices described in this policy, including our use of end-to-end encryption for messages and our handling of user-generated content.
      </p>

      <section>
        <h2 class="dark:dark" role="button" aria-expanded="false" aria-controls="section-1">
          <svg class="toggle-icon" aria-expanded="false" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
          1. Information We Collect
        </h2>
        <div id="section-1" class="section-content" aria-expanded="false">
          <p class="dark:dark">We collect the following types of information to provide and improve our Services:</p>
          <ul class="dark:dark">
            <li><strong>Personal Information</strong>: When you sign up or use our Services, we collect your email address, username, and optional profile picture (via Firebase Authentication, Cloudinary uploads, or third-party services like Gravatar).</li>
            <li><strong>Messages</strong>: All messages sent through BanterBox are end-to-end encrypted using industry-standard protocols (e.g., AES-256). We do not store or access the content of your messages, ensuring your conversations remain private.</li>
            <li><strong>Settings Data</strong>: We store your preferences, such as notification settings (push, sound, vibration, tone), theme (light/dark), font size, wallpaper, status visibility, two-factor authentication (2FA), and low data mode, in our Firebase database.</li>
            <li><strong>Blocked Users and Devices</strong>: Information about users you block or devices linked to your account is stored to manage interactions and security.</li>
            <li><strong>User-Generated Content</strong>: Includes messages, profile pictures, and statuses you create. You retain ownership of your content, but grant us a limited license as described in Section 4.</li>
            <li><strong>Usage and Technical Data</strong>: We collect IP addresses, browser type, device information, operating system, app version, and access times for analytics and security purposes.</li>
            <li><strong>Freepik Sticker URLs</strong>: If you use Freepik stickers for your profile picture, we store the URL linking to these assets, provided by Freepik Company, S.L.U., under their terms.</li>
          </ul>
        </div>
      </section>

      <section>
        <h2 class="dark:dark" role="button" aria-expanded="false" aria-controls="section-2">
          <svg class="toggle-icon" aria-expanded="false" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
          2. How We Use Your Information
        </h2>
        <div id="section-2" class="section-content" aria-expanded="false">
          <p class="dark:dark">We use your information to:</p>
          <ul class="dark:dark">
            <li>Provide and personalize our Services, such as displaying your username, profile picture, or status.</li>
            <li>Secure your messages with end-to-end encryption, ensuring only you and the recipient can read them.</li>
            <li>Manage account settings, including notifications, privacy, and security features like 2FA.</li>
            <li>Maintain blocked user lists and linked device records to enforce your preferences.</li>
            <li>Analyze usage data to improve performance, troubleshoot issues, and enhance user experience.</li>
            <li>Comply with legal obligations under laws like GDPR (EU), CCPA (California), POPIA (South Africa), and other applicable regulations.</li>
          </ul>
        </div>
      </section>

      <section>
        <h2 class="dark:dark" role="button" aria-expanded="false" aria-controls="section-3">
          <svg class="toggle-icon" aria-expanded="false" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
          3. Sharing Your Information
        </h2>
        <div id="section-3" class="section-content" aria-expanded="false">
          <p class="dark:dark">We may share your information with:</p>
          <ul class="dark:dark">
            <li><strong>Firebase (Google Cloud)</strong>: Used for authentication, database storage, analytics, and backups. Firebase may collect identifiers (e.g., IP addresses, device IDs). See <a href="https://policies.google.com/privacy" class="link dark:link" aria-label="Google Privacy Policy">Google's Privacy Policy</a>.</li>
            <li><strong>Cloudinary</strong>: Used for profile picture uploads. Cloudinary may process image metadata and technical identifiers. See <a href="https://cloudinary.com/privacy" class="link dark:link" aria-label="Cloudinary Privacy Policy">Cloudinary's Privacy Policy</a>.</li>
            <li><strong>Freepik</strong>: If you use Freepik stickers, we store the sticker URL, which Freepik may process for analytics or attribution. Freepik may collect your username, email, or IP address with your consent. See <a href="https://www.freepik.com/privacy" class="link dark:link" aria-label="Freepik Privacy Policy">Freepik's Privacy Policy</a>.</li>
            <li><strong>Gravatar</strong>: If you use a Gravatar profile picture, your hashed email is shared with Gravatar. See <a href="https://en.gravatar.com/site/privacy" class="link dark:link" aria-label="Gravatar Privacy Policy">Gravatar's Privacy Policy</a>.</li>
            <li><strong>Legal Authorities</strong>: We may disclose information to comply with legal obligations, respond to lawful requests, or protect our rights, users, or third parties.</li>
          </ul>
          <p class="dark:dark">We do not share message content, as it is end-to-end encrypted and inaccessible to us or third parties.</p>
        </div>
      </section>

      <section>
        <h2 class="dark:dark" role="button" aria-expanded="false" aria-controls="section-4">
          <svg class="toggle-icon" aria-expanded="false" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
          4. Copyright and User-Generated Content
        </h2>
        <div id="section-4" class="section-content" aria-expanded="false">
          <p class="dark:dark">
            You retain ownership of user-generated content (e.g., messages, profile pictures, statuses). By using BanterBox, you grant My Two Minutes PTY a worldwide, non-exclusive, royalty-free license to use, store, and display your content solely to provide the Services (e.g., displaying your profile picture or status to other users).
          </p>
          <p class="dark:dark">
            Freepik stickers and other third-party assets are licensed under <a href="https://www.freepik.com/terms-of-use" class="link dark:link" aria-label="Freepik Terms of Use">Freepik's Terms of Use</a>. You may not reproduce, distribute, or modify these assets outside BanterBox without Freepik's permission. My Two Minutes PTY is not liable for misuse of third-party content by users.
          </p>
          <p class="dark:dark">
            You are responsible for ensuring your content does not infringe on third-party copyrights, trademarks, or other rights. We may remove content or suspend accounts for violations, as determined in our sole discretion.
          </p>
        </div>
      </section>

      <section>
        <h2 class="dark:dark" role="button" aria-expanded="false" aria-controls="section-5">
          <svg class="toggle-icon" aria-expanded="false" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
          5. Message Encryption
        </h2>
        <div id="section-5" class="section-content" aria-expanded="false">
          <p class="dark:dark">
            All messages sent via BanterBox are protected with end-to-end encryption using AES-256 or equivalent protocols. This ensures that only you and the intended recipient can access message content. Neither My Two Minutes PTY nor any third party, including Firebase, can decrypt or view your messages. Encryption keys are managed on your device, and you are responsible for securing your device and account credentials.
          </p>
        </div>
      </section>

      <section>
        <h2 class="dark:dark" role="button" aria-expanded="false" aria-controls="section-6">
          <svg class="toggle-icon" aria-expanded="false" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
          6. Your Privacy Rights
        </h2>
        <div id="section-6" class="section-content" aria-expanded="false">
          <p class="dark:dark">Under laws like GDPR (EU), CCPA (California), and POPIA (South Africa), you may have the following rights:</p>
          <ul class="dark:dark">
            <li><strong>Access</strong>: Request a copy of your personal data (e.g., email, settings).</li>
            <li><strong>Rectification</strong>: Correct inaccurate data via the Profile page.</li>
            <li><strong>Erasure</strong>: Delete your account via the Settings page, removing your data from our servers (subject to Firebase retention policies).</li>
            <li><strong>Restriction</strong>: Limit processing of your data (e.g., opt out of analytics below).</li>
            <li><strong>Portability</strong>: Receive your data in a structured, machine-readable format.</li>
            <li><strong>Objection</strong>: Object to data processing for analytics or other purposes.</li>
            <li><strong>Withdraw Consent</strong>: Revoke consent for non-essential data processing at any time.</li>
          </ul>
          <p class="dark:dark">
            To exercise these rights, use the contact form below or email us at privacy@mytwominutes.com. Note that deleting your BanterBox account does not automatically remove data held by third parties (e.g., Firebase, Cloudinary, Freepik, Gravatar); contact them directly for their deletion processes.
          </p>
          <div class="flex justify-between items-center mt-2">
            <span class="text-gray-700 dark:label-dark">Consent to Analytics</span>
            <label class="toggle">
              <input id="analytics-consent" type="checkbox" role="switch" aria-checked="true" aria-label="Toggle analytics consent" />
              <span class="slider"></span>
            </label>
          </div>
          <p id="consent-error" class="error-message dark:error-message" role="alert">
            <span>Failed to update analytics consent.</span>
            <button id="consent-retry-btn" class="retry-btn" aria-label="Retry updating analytics consent">Retry</button>
          </p>
        </div>
      </section>

      <section>
        <h2 class="dark:dark" role="button" aria-expanded="false" aria-controls="section-7">
          <svg class="toggle-icon" aria-expanded="false" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
          7. Data Security
        </h2>
        <div id="section-7" class="section-content" aria-expanded="false">
          <p class="dark:dark">
            We use Firebase and Cloudinaryâ€™s security features, including encryption in transit (TLS) and at rest (AES-256), to protect your data. Messages are end-to-end encrypted, ensuring privacy. In the event of a data breach, we will notify affected users within 72 hours, as required by GDPR and other laws. However, no internet transmission is 100% secure, and you provide information at your own risk.
          </p>
        </div>
      </section>

      <section>
        <h2 class="dark:dark" role="button" aria-expanded="false" aria-controls="section-8">
          <svg class="toggle-icon" aria-expanded="false" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
          8. Data Retention
        </h2>
        <div id="section-8" class="section-content" aria-expanded="false">
          <p class="dark:dark">
            We retain personal information (e.g., email, username, settings) and user-generated content (e.g., profile pictures, statuses) only as long as your account is active. Upon account deletion via the Settings page, we remove your data from our servers within 30 days, subject to Firebase and Cloudinary retention policies. Freepik sticker URLs are deleted when your account is terminated.
          </p>
        </div>
      </section>

      <section>
        <h2 class="dark:dark" role="button" aria-expanded="false" aria-controls="section-9">
          <svg class="toggle-icon" aria-expanded="false" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
          9. Third-Party Links and Services
        </h2>
        <div id="section-9" class="section-content" aria-expanded="false">
          <p class="dark:dark">
            Our Services link to third-party providers (e.g., Firebase, Cloudinary, Freepik, Gravatar). We are not responsible for their privacy practices or content. Review their respective policies before sharing personal information:
          </p>
          <ul class="dark:dark">
            <li><a href="https://policies.google.com/privacy" class="link dark:link" aria-label="Google Privacy Policy">Firebase (Google)</a></li>
            <li><a href="https://cloudinary.com/privacy" class="link dark:link" aria-label="Cloudinary Privacy Policy">Cloudinary</a></li>
            <li><a href="https://www.freepik.com/privacy" class="link dark:link" aria-label="Freepik Privacy Policy">Freepik</a></li>
            <li><a href="https://en.gravatar.com/site/privacy" class="link dark:link" aria-label="Gravatar Privacy Policy">Gravatar</a></li>
          </ul>
        </div>
      </section>

      <section>
        <h2 class="dark:dark" role="button" aria-expanded="false" aria-controls="section-10">
          <svg class="toggle-icon" aria-expanded="false" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
          10. Intellectual Property and Liability
        </h2>
        <div id="section-10" class="section-content" aria-expanded="false">
          <p class="dark:dark">
            All BanterBox content, including UI designs, logos, and proprietary code, is owned by My Two Minutes PTY and protected by South African and international copyright laws. Unauthorized use is prohibited.
          </p>
          <p class="dark:dark">
            My Two Minutes PTY is not liable for user-generated content that infringes third-party rights or violates applicable laws. We may remove such content or suspend accounts without notice. Users indemnify My Two Minutes PTY against claims arising from their content or use of third-party assets (e.g., Freepik stickers).
          </p>
        </div>
      </section>

      <section>
        <h2 class="dark:dark" role="button" aria-expanded="false" aria-controls="section-11">
          <svg class="toggle-icon" aria-expanded="false" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
          11. Changes to This Policy
        </h2>
        <div id="section-11" class="section-content" aria-expanded="false">
          <p class="dark:dark">
            We may update this Privacy Policy to reflect changes in our practices or legal requirements. We will notify you via email, in-app notification, or by updating the "Last updated" date. Continued use of the Services after changes constitutes acceptance of the updated policy.
          </p>
        </div>
      </section>

      <section>
        <h2 class="dark:dark" role="button" aria-expanded="false" aria-controls="section-12">
          <svg class="toggle-icon" aria-expanded="false" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
          12. Contact Us
        </h2>
        <div id="section-12" class="section-content" aria-expanded="false">
          <p class="dark:dark">
            For questions, privacy inquiries, or to exercise your rights, contact us at <a href="mailto:privacy@mytwominutes.com" class="link dark:link" aria-label="Email privacy contact">privacy@mytwominutes.com</a> or use the form below.
          </p>
          <form class="contact-form" role="form" aria-describedby="contact-error">
            <label for="contact-name" class="text-gray-700 dark:label-dark">Name</label>
            <input id="contact-name" type="text" class="input-field dark:input-field" placeholder="Your name" aria-label="Your name" />
            <label for="contact-email" class="text-gray-700 dark:label-dark">Email</label>
            <input id="contact-email" type="email" class="input-field dark:input-field" placeholder="Your email" aria-label="Your email" required />
            <label for="contact-message" class="text-gray-700 dark:label-dark">Message</label>
            <textarea id="contact-message" class="input-field dark:input-field" rows="4" placeholder="Your message" aria-label="Your message" required></textarea>
            <button type="submit" class="btn btn-primary" aria-label="Submit contact form">Submit</button>
            <p id="contact-error" class="error-message dark:error-message" role="alert">
              <span>Failed to send message.</span>
              <button id="contact-retry-btn" class="retry-btn" aria-label="Retry sending message">Retry</button>
            </p>
          </form>
        </div>
      </section>

      <p class="dark:dark">
        <a href="settings.html" class="link dark:link" aria-label="Back to settings">Back to Settings</a>
      </p>
    </div>

    <footer class="text-center text-gray-500 dark:text-gray-400 py-4">
      <p>
        Some icons and stickers used in BanterBox are sourced from <a href="https://www.freepik.com" class="link dark:link" aria-label="Freepik website">Freepik</a>. All rights reserved by Freepik Company, S.L.U.
      </p>
    </footer>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-auth.js";
    import { getDatabase, ref, get, update } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
      authDomain: "fire-b-a8878.firebaseapp.com",
      databaseURL: "https://fire-b-a8878.firebaseio.com",
      projectId: "fire-b-a8878",
      storageBucket: "fire-b-a8878.appspot.com",
      messagingSenderId: "658673187627",
      appId: "1:658673187627:web:6e4c29af661785f0afa36e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getDatabase();

    const analyticsConsent = document.getElementById('analytics-consent');
    const contactForm = document.querySelector('.contact-form');
    const contactName = document.getElementById('contact-name');
    const contactEmail = document.getElementById('contact-email');
    const contactMessage = document.getElementById('contact-message');
    const contactError = document.getElementById('contact-error');
    const contactRetryBtn = document.getElementById('contact-retry-btn');

    function applyTheme(themeValue) {
      const isDark = themeValue === 'dark';
      document.body.classList.toggle('dark', isDark);
      document.querySelector('.header').classList.toggle('dark', isDark);
      document.querySelector('.content').classList.toggle('dark', isDark);
      document.querySelectorAll('h1, h2, p, ul').forEach(el => el.classList.toggle('dark', isDark));
      document.querySelectorAll('.link').forEach(el => el.classList.toggle('dark', isDark));
      document.querySelectorAll('.input-field').forEach(el => el.classList.toggle('dark', isDark));
      document.querySelector('.error-message').classList.toggle('dark', isDark);
    }

    function applyFontSize(size) {
      const root = document.documentElement;
      root.style.fontSize = size === 'small' ? '14px' : size === 'large' ? '18px' : '16px';
    }

    function toggleSection(e) {
      const header = e.currentTarget;
      const content = header.nextElementSibling;
      const icon = header.querySelector('.toggle-icon');
      const isExpanded = content.getAttribute('aria-expanded') === 'true';
      content.setAttribute('aria-expanded', !isExpanded);
      icon.setAttribute('aria-expanded', !isExpanded);
      header.setAttribute('aria-expanded', !isExpanded);
    }

    function handleSwipe(element, callback) {
      let startX, startY;
      element.addEventListener('touchstart', e => {
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
      });
      element.addEventListener('touchend', e => {
        const endX = e.changedTouches[0].clientX;
        const endY = e.changedTouches[0].clientY;
        if (Math.abs(endY - startY) < 50 && endX - startX > 100) {
          callback();
        }
      });
    }

    function showError(element, message) {
      element.querySelector('span').textContent = message;
      element.classList.add('show');
    }
    function hideError(element) {
      element.classList.remove('show');
    }

    onAuthStateChanged(auth, async user => {
      try {
        const snap = await get(ref(db, `users/${user?.uid || 'guest'}/settings`));
        const settings = snap.val() || {};
        applyTheme(settings.theme || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'));
        applyFontSize(settings.fontSize || 'medium');
        analyticsConsent.checked = settings.analyticsConsent ?? true;
        analyticsConsent.setAttribute('aria-checked', analyticsConsent.checked);
      } catch (error) {
        console.error('Error loading settings:', error);
        applyTheme(window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      }
    });

    document.querySelectorAll('h2').forEach(header => {
      header.addEventListener('click', toggleSection);
      handleSwipe(header, toggleSection);
    });

    async function saveAnalyticsConsent() {
      try {
        await update(ref(db, `users/${auth.currentUser?.uid || 'guest'}/settings`), {
          analyticsConsent: analyticsConsent.checked
        });
        analyticsConsent.setAttribute('aria-checked', analyticsConsent.checked);
        hideError(contactError);
        return true;
      } catch (error) {
        console.error('Error saving analytics consent:', error);
        showError(contactError, 'Failed to update analytics consent.');
        return false;
      }
    }

    analyticsConsent.addEventListener('change', saveAnalyticsConsent);
    contactRetryBtn.addEventListener('click', saveAnalyticsConsent);

    contactForm.addEventListener('submit', async e => {
      e.preventDefault();
      const name = contactName.value.trim();
      const email = contactEmail.value.trim();
      const message = contactMessage.value.trim();
      if (!email || !message) {
        showError(contactError, 'Please fill in all required fields.');
        return;
      }
      try {
        await update(ref(db, `contact_requests/${Date.now()}`), {
          name,
          email,
          message,
          timestamp: Date.now(),
          userId: auth.currentUser?.uid || 'guest'
        });
        contactForm.reset();
        hideError(contactError);
      } catch (error) {
        console.error('Error sending contact form:', error);
        showError(contactError, 'Failed to send message.');
      }
    });

    contactRetryBtn.addEventListener('click', () => contactForm.requestSubmit());

    // Keyboard accessibility
    document.querySelectorAll('h2').forEach(header => {
      header.addEventListener('keydown', e => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          toggleSection(e);
        }
      });
    });
  </script>
</body>
</html>
