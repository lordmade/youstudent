<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>Vynix AI â€¢ Image Generator</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Rounded" rel="stylesheet" />
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <style>
    :root {
      --bg-body: #F0F4F9;
      --bg-surface: #FFFFFF;
      --primary-gradient: linear-gradient(135deg, #4285F4, #D96570);
      --text-main: #1F1F1F;
      --text-secondary: #444746;
      --text-muted: #8E918F;
      --success: #34A853;
      --error: #EA4335;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
      --shadow-lg: 0 8px 30px rgba(0,0,0,0.15);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      user-select: none;
    }
    
    body {
      font-family: 'Outfit', system-ui, sans-serif;
      background: var(--bg-body);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    /* Header */
    .header {
      background: var(--bg-surface);
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: var(--shadow-sm);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .brand-logo {
      width: 40px;
      height: 40px;
      background: var(--primary-gradient);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 1.2rem;
    }
    
    .brand-text {
      font-weight: 600;
      font-size: 1.25rem;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .back-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 24px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      font-family: inherit;
      font-weight: 500;
      transition: background 0.2s;
    }
    
    .back-btn:hover {
      background: rgba(0,0,0,0.05);
    }
    
    /* Main Container */
    .container {
      flex: 1;
      max-width: 900px;
      width: 100%;
      margin: 0 auto;
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    
    /* Input Section */
    .input-section {
      background: var(--bg-surface);
      border-radius: 24px;
      padding: 24px;
      box-shadow: var(--shadow-md);
    }
    
    .section-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 16px;
      color: var(--text-main);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .prompt-input {
      width: 100%;
      min-height: 120px;
      padding: 16px;
      border: 2px solid #E1E5EA;
      border-radius: 16px;
      font-family: inherit;
      font-size: 1rem;
      resize: vertical;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
      background: #FAFBFC;
    }
    
    .prompt-input:focus {
      border-color: #4285F4;
      box-shadow: 0 0 0 4px rgba(66, 133, 244, 0.1);
    }
    
    .prompt-input::placeholder {
      color: var(--text-muted);
    }
    
    /* Options Grid */
    .options-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    
    .option-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .option-label {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-secondary);
    }
    
    .option-select {
      padding: 12px 16px;
      border: 2px solid #E1E5EA;
      border-radius: 12px;
      font-family: inherit;
      font-size: 0.95rem;
      background: #FAFBFC;
      cursor: pointer;
      outline: none;
      transition: border-color 0.2s;
    }
    
    .option-select:focus {
      border-color: #4285F4;
    }
    
    /* Generate Button */
    .generate-btn {
      width: 100%;
      padding: 16px 32px;
      margin-top: 20px;
      border: none;
      border-radius: 16px;
      background: var(--primary-gradient);
      color: white;
      font-family: inherit;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: var(--shadow-md);
      position: relative;
    }
    
    .generate-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
    
    .generate-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .generate-btn.loading {
      color: transparent;
    }
    
    .generate-btn.loading::after {
      content: '';
      position: absolute;
      width: 24px;
      height: 24px;
      border: 3px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Loading State */
    .loading-container {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 20px;
      gap: 20px;
    }
    
    .loading-container.active {
      display: flex;
    }
    
    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid #E1E5EA;
      border-top-color: #4285F4;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    .loading-text {
      font-size: 1.1rem;
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    .loading-subtext {
      font-size: 0.9rem;
      color: var(--text-muted);
    }
    
    /* Result Section */
    .result-section {
      display: none;
      background: var(--bg-surface);
      border-radius: 24px;
      padding: 24px;
      box-shadow: var(--shadow-md);
      animation: fadeIn 0.5s ease;
    }
    
    .result-section.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .result-image-container {
      position: relative;
      width: 100%;
      border-radius: 16px;
      overflow: hidden;
      background: #F0F4F9;
      aspect-ratio: 1;
    }
    
    .result-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }
    
    .image-placeholder {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 16px;
      color: var(--text-muted);
    }
    
    .image-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    .action-btn {
      flex: 1;
      min-width: 140px;
      padding: 14px 24px;
      border-radius: 12px;
      border: none;
      font-family: inherit;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
    }
    
    .action-btn.primary {
      background: var(--primary-gradient);
      color: white;
    }
    
    .action-btn.secondary {
      background: #F0F4F9;
      color: var(--text-secondary);
      border: 2px solid #E1E5EA;
    }
    
    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }
    
    /* Gallery Section */
    .gallery-section {
      margin-top: 24px;
    }
    
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    
    .gallery-item {
      position: relative;
      aspect-ratio: 1;
      border-radius: 16px;
      overflow: hidden;
      cursor: pointer;
      background: #F0F4F9;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .gallery-item:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }
    
    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .gallery-item-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
      opacity: 0;
      transition: opacity 0.2s;
      display: flex;
      align-items: flex-end;
      padding: 16px;
    }
    
    .gallery-item:hover .gallery-item-overlay {
      opacity: 1;
    }
    
    .gallery-item-prompt {
      color: white;
      font-size: 0.85rem;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    
    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: #1F1F1F;
      color: white;
      padding: 14px 28px;
      border-radius: 50px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: var(--shadow-lg);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      z-index: 1000;
    }
    
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    
    .toast.success { background: var(--success); }
    .toast.error { background: var(--error); }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }
    
    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    /* Responsive */
    @media (max-width: 600px) {
      .container { padding: 16px; }
      .options-grid { grid-template-columns: 1fr; }
      .brand-text { font-size: 1.1rem; }
      .image-actions { flex-direction: column; }
      .action-btn { width: 100%; }
    }
    
    /* Progress Bar for Generation */
    .progress-container {
      width: 100%;
      max-width: 300px;
      height: 6px;
      background: #E1E5EA;
      border-radius: 3px;
      overflow: hidden;
      margin-top: 16px;
    }
    
    .progress-bar {
      height: 100%;
      background: var(--primary-gradient);
      border-radius: 3px;
      width: 0%;
      transition: width 0.3s ease;
    }
    
    /* Seed Input */
    .seed-container {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 12px;
    }
    
    .seed-input {
      flex: 1;
      padding: 10px 16px;
      border: 2px solid #E1E5EA;
      border-radius: 12px;
      font-family: inherit;
      font-size: 0.9rem;
      outline: none;
    }
    
    .seed-btn {
      padding: 10px 16px;
      border: none;
      border-radius: 12px;
      background: #F0F4F9;
      color: var(--text-secondary);
      cursor: pointer;
      font-family: inherit;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: background 0.2s;
    }
    
    .seed-btn:hover {
      background: #E1E5EA;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="brand">
      <div class="brand-logo">V</div>
      <span class="brand-text">AI Image Generator</span>
    </div>
    <button class="back-btn" onclick="goBack()">
      <span class="material-symbols-rounded">arrow_back</span>
      Back to Chat
    </button>
  </header>

  <!-- Main Container -->
  <main class="container">
    <!-- Input Section -->
    <section class="input-section">
      <h2 class="section-title">
        <span class="material-symbols-rounded">auto_fix_high</span>
        Describe Your Image
      </h2>
      
      <textarea 
        class="prompt-input" 
        id="promptInput" 
        placeholder="Describe what you want to generate... (e.g., 'A futuristic city with flying cars at sunset, cyberpunk style')"
        maxlength="1000"
      ></textarea>
      
      <div class="options-grid">
        <div class="option-group">
          <label class="option-label">Aspect Ratio</label>
          <select class="option-select" id="ratioSelect">
            <option value="1:1">Square (1:1)</option>
            <option value="16:9">Widescreen (16:9)</option>
            <option value="9:16">Portrait (9:16)</option>
            <option value="4:3">Standard (4:3)</option>
            <option value="3:4">Portrait (3:4)</option>
          </select>
        </div>
        
        <div class="option-group">
          <label class="option-label">Style</label>
          <select class="option-select" id="styleSelect">
            <option value="default">Default</option>
            <option value="photorealistic">Photorealistic</option>
            <option value="digital-art">Digital Art</option>
            <option value="anime">Anime</option>
            <option value="oil-painting">Oil Painting</option>
            <option value="watercolor">Watercolor</option>
            <option value="sketch">Sketch</option>
            <option value="3d-render">3D Render</option>
          </select>
        </div>
        
        <div class="option-group">
          <label class="option-label">Quality</label>
          <select class="option-select" id="qualitySelect">
            <option value="fast">Fast (512x512)</option>
            <option value="standard" selected>Standard (1024x1024)</option>
            <option value="hd">HD (2048x2048)</option>
          </select>
        </div>
      </div>
      
      <div class="seed-container">
        <input 
          type="text" 
          class="seed-input" 
          id="seedInput" 
          placeholder="Random seed (optional)"
          readonly
        />
        <button class="seed-btn" onclick="randomizeSeed()" title="Randomize seed">
          <span class="material-symbols-rounded">shuffle</span>
          Random
        </button>
        <button class="seed-btn" onclick="clearSeed()" title="Clear seed">
          <span class="material-symbols-rounded">clear</span>
        </button>
      </div>
      
      <button class="generate-btn" id="generateBtn" onclick="generateImage()">
        <span class="material-symbols-rounded">magic_button</span>
        Generate Image
      </button>
    </section>

    <!-- Loading State -->
    <div class="loading-container" id="loadingContainer">
      <div class="loading-spinner"></div>
      <p class="loading-text">Creating your masterpiece...</p>
      <p class="loading-subtext">This may take 10-30 seconds</p>
      <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
      </div>
    </div>

    <!-- Result Section -->
    <section class="result-section" id="resultSection">
      <h2 class="section-title">
        <span class="material-symbols-rounded">check_circle</span>
        Your Image is Ready
      </h2>
      
      <div class="result-image-container" id="resultContainer">
        <div class="image-placeholder" id="imagePlaceholder">
          <span class="material-symbols-rounded" style="font-size: 64px;">image</span>
          <p>Image will appear here</p>
        </div>
        <img class="result-image" id="resultImage" alt="Generated image" style="display: none;" />
      </div>
      
      <div class="image-actions">
        <button class="action-btn primary" onclick="downloadImage()">
          <span class="material-symbols-rounded">download</span>
          Download
        </button>
        <button class="action-btn secondary" onclick="generateVariation()">
          <span class="material-symbols-rounded">autorenew</span>
          Variation
        </button>
        <button class="action-btn secondary" onclick="shareImage()">
          <span class="material-symbols-rounded">share</span>
          Share
        </button>
        <button class="action-btn secondary" onclick="resetGenerator()">
          <span class="material-symbols-rounded">add</span>
          New
        </button>
      </div>
    </section>

    <!-- Gallery Section -->
    <section class="gallery-section" id="gallerySection">
      <h2 class="section-title">
        <span class="material-symbols-rounded">history</span>
        Recent Generations
      </h2>
      <div class="gallery-grid" id="galleryGrid">
        <div class="empty-state">
          <span class="material-symbols-rounded empty-state-icon">photo_library</span>
          <p>No images generated yet</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Toast -->
  <div class="toast" id="toast">
    <span class="material-symbols-rounded" id="toastIcon">check</span>
    <span id="toastMessage">Success</span>
  </div>

  <script>
    // ==================== HARDCODED API CONFIGURATION ====================
    // FIXED: Removed trailing space from baseUrl
    const apiConfig = {
      baseUrl: 'https://image.pollinations.ai/prompt',
      defaultParams: {
        nologo: true,
        enhance: true,
        safe: true,
        model: 'flux'
      }
    };

    // ==================== FIREBASE CONFIGURATION ====================
    const firebaseConfig = {
      apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
      authDomain: "fire-b-a8878.firebaseapp.com",
      projectId: "fire-b-a8878",
      appId: "1:658673187627:web:6e4c29af661785f0afa36e"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // ==================== GLOBAL STATE ====================
    let currentImageUrl = null;
    let currentPrompt = '';
    let generationHistory = JSON.parse(localStorage.getItem('vynix_image_history') || '[]');

    // ==================== NAVIGATION ====================
    function goBack() {
      window.location.href = 'ai.html';
    }

    // ==================== SEED MANAGEMENT ====================
    function randomizeSeed() {
      const seed = Math.floor(Math.random() * 1000000);
      document.getElementById('seedInput').value = seed;
    }

    function clearSeed() {
      document.getElementById('seedInput').value = '';
    }

    // ==================== IMAGE GENERATION ====================
    async function generateImage() {
      const prompt = document.getElementById('promptInput').value.trim();
      
      if (!prompt) {
        showToast('Please enter a description', 'error');
        document.getElementById('promptInput').focus();
        return;
      }

      // UI Updates
      const btn = document.getElementById('generateBtn');
      btn.disabled = true;
      btn.classList.add('loading');
      
      document.getElementById('resultSection').classList.remove('active');
      document.getElementById('loadingContainer').classList.add('active');
      
      // Progress animation
      let progress = 0;
      const progressBar = document.getElementById('progressBar');
      const progressInterval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 90) progress = 90;
        progressBar.style.width = progress + '%';
      }, 1000);

      try {
        // Build the generation parameters
        const ratio = document.getElementById('ratioSelect').value;
        const style = document.getElementById('styleSelect').value;
        const quality = document.getElementById('qualitySelect').value;
        const seed = document.getElementById('seedInput').value;
        
        // Calculate dimensions based on ratio and quality
        const dimensions = calculateDimensions(ratio, quality);
        
        // Enhance prompt with style
        let enhancedPrompt = prompt;
        if (style !== 'default') {
          enhancedPrompt += `, ${style.replace(/-/g, ' ')} style, high quality, detailed`;
        }
        
        // Build parameters
        const params = new URLSearchParams({
          width: dimensions.width,
          height: dimensions.height,
          seed: seed || Math.floor(Math.random() * 1000000),
          nologo: 'true',
          enhance: 'true',
          model: 'flux'
        });
        
        // FIXED: Correct URL format - no extra slash before prompt
        const encodedPrompt = encodeURIComponent(enhancedPrompt);
        const imageUrl = `${apiConfig.baseUrl}/${encodedPrompt}?${params.toString()}`;
        
        console.log('Generating image with URL:', imageUrl); // Debug log
        
        // Preload image
        await preloadImage(imageUrl);
        
        // Success
        currentImageUrl = imageUrl;
        currentPrompt = prompt;
        
        // Display result
        displayResult(imageUrl, prompt);
        
        // Save to history
        addToHistory({
          url: imageUrl,
          prompt: prompt,
          timestamp: Date.now(),
          style: style,
          ratio: ratio
        });
        
        showToast('Image generated successfully!', 'success');
        
      } catch (error) {
        console.error('Generation error:', error);
        showToast('Failed to generate image: ' + error.message, 'error');
      } finally {
        clearInterval(progressInterval);
        progressBar.style.width = '100%';
        
        setTimeout(() => {
          btn.disabled = false;
          btn.classList.remove('loading');
          document.getElementById('loadingContainer').classList.remove('active');
          progressBar.style.width = '0%';
        }, 500);
      }
    }

    function calculateDimensions(ratio, quality) {
      const qualitySizes = {
        fast: 512,
        standard: 1024,
        hd: 1536  // Reduced from 2048 to avoid potential limits
      };
      
      const baseSize = qualitySizes[quality] || 1024;
      
      const ratios = {
        '1:1': { w: 1, h: 1 },
        '16:9': { w: 16, h: 9 },
        '9:16': { w: 9, h: 16 },
        '4:3': { w: 4, h: 3 },
        '3:4': { w: 3, h: 4 }
      };
      
      const r = ratios[ratio] || ratios['1:1'];
      
      // Calculate dimensions maintaining aspect ratio
      let width, height;
      if (r.w > r.h) {
        width = baseSize;
        height = Math.round(baseSize * (r.h / r.w));
      } else {
        height = baseSize;
        width = Math.round(baseSize * (r.w / r.h));
      }
      
      // Ensure dimensions are valid (max 1536 to be safe)
      width = Math.min(width, 1536);
      height = Math.min(height, 1536);
      
      // Ensure minimum size
      width = Math.max(width, 64);
      height = Math.max(height, 64);
      
      return { width, height };
    }

    function preloadImage(url) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = 'anonymous'; // Enable CORS
        img.onload = () => resolve();
        img.onerror = (e) => reject(new Error('Failed to load image from API'));
        img.src = url;
        
        // Timeout after 60 seconds
        setTimeout(() => reject(new Error('Image generation timeout')), 60000);
      });
    }

    function displayResult(url, prompt) {
      const resultSection = document.getElementById('resultSection');
      const resultImage = document.getElementById('resultImage');
      const placeholder = document.getElementById('imagePlaceholder');
      
      resultImage.src = url;
      resultImage.style.display = 'block';
      placeholder.style.display = 'none';
      
      resultSection.classList.add('active');
      
      // Scroll to result
      resultSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    // ==================== HISTORY MANAGEMENT ====================
    function addToHistory(item) {
      generationHistory.unshift(item);
      if (generationHistory.length > 20) {
        generationHistory = generationHistory.slice(0, 20);
      }
      localStorage.setItem('vynix_image_history', JSON.stringify(generationHistory));
      renderGallery();
    }

    function renderGallery() {
      const grid = document.getElementById('galleryGrid');
      
      if (generationHistory.length === 0) {
        grid.innerHTML = `
          <div class="empty-state" style="grid-column: 1/-1;">
            <span class="material-symbols-rounded empty-state-icon">photo_library</span>
            <p>No images generated yet</p>
          </div>
        `;
        return;
      }
      
      grid.innerHTML = generationHistory.map((item, index) => `
        <div class="gallery-item" onclick="loadFromHistory(${index})">
          <img src="${item.url}" alt="${escapeHtml(item.prompt)}" loading="lazy" crossorigin="anonymous" />
          <div class="gallery-item-overlay">
            <p class="gallery-item-prompt">${escapeHtml(item.prompt)}</p>
          </div>
        </div>
      `).join('');
    }

    function loadFromHistory(index) {
      const item = generationHistory[index];
      if (item) {
        document.getElementById('promptInput').value = item.prompt;
        document.getElementById('styleSelect').value = item.style || 'default';
        document.getElementById('ratioSelect').value = item.ratio || '1:1';
        displayResult(item.url, item.prompt);
        currentImageUrl = item.url;
        currentPrompt = item.prompt;
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    // ==================== IMAGE ACTIONS ====================
    async function downloadImage() {
      if (!currentImageUrl) return;
      
      try {
        const response = await fetch(currentImageUrl);
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `vynix-ai-${Date.now()}.png`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        showToast('Image downloaded!', 'success');
      } catch (error) {
        // Fallback: open in new tab
        window.open(currentImageUrl, '_blank');
        showToast('Opening image in new tab', 'success');
      }
    }

    function generateVariation() {
      if (!currentPrompt) return;
      
      // Randomize seed for variation
      randomizeSeed();
      
      // Keep the same prompt but generate with new seed
      generateImage();
    }

    async function shareImage() {
      if (!currentImageUrl) return;
      
      if (navigator.share) {
        try {
          await navigator.share({
            title: 'AI Generated Image',
            text: `Check out this AI image I created: "${currentPrompt}"`,
            url: currentImageUrl
          });
        } catch (error) {
          // User cancelled or error
          copyToClipboard(currentImageUrl);
        }
      } else {
        copyToClipboard(currentImageUrl);
      }
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        showToast('Image link copied!', 'success');
      }).catch(() => {
        showToast('Failed to copy', 'error');
      });
    }

    function resetGenerator() {
      document.getElementById('promptInput').value = '';
      document.getElementById('resultSection').classList.remove('active');
      document.getElementById('resultImage').style.display = 'none';
      document.getElementById('imagePlaceholder').style.display = 'flex';
      currentImageUrl = null;
      currentPrompt = '';
      randomizeSeed();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ==================== UTILITY ====================
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastIcon = document.getElementById('toastIcon');
      const toastMessage = document.getElementById('toastMessage');
      
      toast.className = 'toast ' + type;
      toastIcon.textContent = type === 'success' ? 'check_circle' : 'error';
      toastMessage.textContent = message;
      
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ==================== AUTH CHECK ====================
    auth.onAuthStateChanged(user => {
      if (!user) {
        // Optional: redirect to login or show auth modal
        // window.location.href = 'signup.html';
      }
    });

    // ==================== INIT ====================
    document.addEventListener('DOMContentLoaded', () => {
      renderGallery();
      randomizeSeed();
      
      // Enter key to generate
      document.getElementById('promptInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          generateImage();
        }
      });
    });
  </script>
</body>
</html>
