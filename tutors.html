<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Same as previous tutors.html -->
</head>
<body class="bg-[#181818] text-white">
  <!-- Loader, Header, Sidebar: Unchanged -->

  <!-- ðŸ”¹ Main Content -->
  <main class="container mx-auto mt-20 p-4">
    <!-- Profile Section -->
    <section class="mb-8">
      <h2 class="text-2xl font-bold mb-4">Tutor Profile</h2>
      <form id="profile-form" class="space-y-4 md:space-y-0 md:flex md:space-x-4">
        <div class="flex-1">
          <label for="tutor-name" class="block text-sm font-medium text-gray-300">Name</label>
          <input type="text" id="tutor-name" class="mt-1 px-4 py-2 w-full bg-[#121212] border border-gray-600 rounded-md text-white focus:outline-none focus:border-red-500" required />
        </div>
        <div class="flex-1">
          <label for="tutor-bio" class="block text-sm font-medium text-gray-300">Bio</label>
          <textarea id="tutor-bio" class="mt-1 px-4 py-2 w-full bg-[#121212] border border-gray-600 rounded-md text-white focus:outline-none focus:border-red-500" rows="4"></textarea>
        </div>
        <div class="flex-1">
          <label for="tutor-category" class="block text-sm font-medium text-gray-300">Category</label>
          <select id="tutor-category" class="mt-1 px-4 py-2 w-full bg-[#121212] border border-gray-600 rounded-md text-white focus:outline-none focus:border-red-500" required>
            <option value="Physical Sciences">Physical Sciences</option>
            <option value="Mathematics">Mathematics</option>
            <option value="Mathematical Literacy">Mathematical Literacy</option>
            <option value="Accounting">Accounting</option>
            <option value="Commercial">Commercial</option>
            <option value="Geography">Geography</option>
            <option value="Life Sciences">Life Sciences</option>
            <option value="Business Studies">Business Studies</option>
            <option value="English">English</option>
            <option value="IT">IT</option>
            <option value="Networking">Networking</option>
          </select>
        </div>
        <div class="flex-1">
          <label for="tutor-photo" class="block text-sm font-medium text-gray-300">Profile Picture</label>
          <input type="file" id="tutor-photo" accept="image/*" class="mt-1 w-full text-gray-300" />
        </div>
        <div class="flex items-end">
          <button type="submit" class="py-2 px-4 bg-red-600 rounded-md text-white hover:bg-red-700">Update Profile</button>
        </div>
      </form>
    </section>

    <!-- Content Management Section: Unchanged -->
    <!-- Error Message: Unchanged -->
  </main>

  <!-- ðŸ”¹ Firebase and Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-auth.js";
    import { getDatabase, ref, get, set, remove } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-database.js";
    import { getStorage, ref as storageRef, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
      authDomain: "fire-b-a8878.firebaseapp.com",
      databaseURL: "https://fire-b-a8878.firebaseio.com",
      projectId: "fire-b-a8878",
      storageBucket: "fire-b-a8878.firebasestorage.app",
      messagingSenderId: "658673187627",
      appId: "1:658673187627:web:6e4c29af661785f0afa36e",
      measurementId: "G-V4W97VMSKL"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const storage = getStorage(app);

    const userPic = document.getElementById("user-pic");
    const signOutBtn = document.getElementById("sign-out");
    const errorMessage = document.getElementById("error-message");
    const menuBtn = document.getElementById("menu-btn");
    const sidebar = document.getElementById("sidebar");
    const profileForm = document.getElementById("profile-form");
    const tutorName = document.getElementById("tutor-name");
    const tutorBio = document.getElementById("tutor-bio");
    const tutorCategory = document.getElementById("tutor-category"); // New
    const tutorPhoto = document.getElementById("tutor-photo");
    const contentForm = document.getElementById("content-form");
    const contentType = document.getElementById("content-type");
    const fileInputContainer = document.getElementById("file-input-container");
    const textInputContainer = document.getElementById("text-input-container");
    const contentFile = document.getElementById("content-file");
    const contentText = document.getElementById("content-text");
    const contentTitle = document.getElementById("content-title");
    const contentDescription = document.getElementById("content-description");
    const contentGrid = document.getElementById("content-grid");
    const loaderOverlay = document.getElementById("loader-overlay");
    const searchBar = document.getElementById("search-bar");
    const searchContainer = document.getElementById("search-container");
    const logoContainer = document.getElementById("logo-container");

    // Toggle Sidebar, Search Bar, Sign Out, Content Type Toggle: Unchanged

    // Render Content Grid: Unchanged

    // Profile Form Submission
    profileForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      loaderOverlay.style.display = "flex";
      try {
        const user = auth.currentUser;
        if (!user) throw new Error("User not authenticated");
        const tutorRef = ref(db, `tutors/${user.uid}`);
        let photoURL = (await get(tutorRef)).val()?.photoURL || "https://www.gravatar.com/avatar?d=mp";
        if (tutorPhoto.files[0]) {
          const file = tutorPhoto.files[0];
          if (file.size > 10 * 1024 * 1024) throw new Error("Profile picture must be under 10MB");
          const storagePath = `tutor-content/${user.uid}/profile/${file.name}`;
          const fileRef = storageRef(storage, storagePath);
          await uploadBytes(fileRef, file);
          photoURL = await getDownloadURL(fileRef);
        }
        await set(tutorRef, {
          name: tutorName.value,
          bio: tutorBio.value,
          category: tutorCategory.value, // New
          photoURL,
          followers: (await get(tutorRef)).val()?.followers || []
        });
        console.log("Profile updated");
        profileForm.reset();
      } catch (error) {
        console.error("Profile update error:", error);
        errorMessage.textContent = "Error updating profile: " + error.message;
        errorMessage.classList.remove("hidden");
      } finally {
        loaderOverlay.style.display = "none";
      }
    });

    // Content Form Submission: Unchanged

    // Auth State Listener
    onAuthStateChanged(auth, async (user) => {
      loaderOverlay.style.display = "flex";
      try {
        if (user) {
          const userRef = ref(db, "users/" + user.uid);
          const tutorRef = ref(db, "tutors/" + user.uid);
          const userSnapshot = await get(userRef);
          const tutorSnapshot = await get(tutorRef);
          if (userSnapshot.exists()) {
            const userData = userSnapshot.val();
            userPic.src = userData.photoURL || "https://www.gravatar.com/avatar?d=mp";
            console.log("User authenticated:", user.uid);
            if (tutorSnapshot.exists()) {
              const tutorData = tutorSnapshot.val();
              tutorName.value = tutorData.name || "";
              tutorBio.value = tutorData.bio || "";
              tutorCategory.value = tutorData.category || "Physical Sciences"; // New
            }
            await renderContentGrid(user.uid);
          } else {
            console.log("No user data, redirecting to login.html");
            window.location.href = "login.html";
          }
        } else {
          console.log("No user, redirecting to login.html");
          window.location.href = "login.html";
        }
      } catch (error) {
        console.error("Auth state error:", error);
        errorMessage.textContent = "Error loading user data: " + error.message;
        errorMessage.classList.remove("hidden");
      } finally {
        loaderOverlay.style.display = "none";
      }
    });
  </script>
</body>
</html>
