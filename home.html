<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>X Home</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --twitter-blue: #1DA1F2;
      --twitter-purple: #8A3FFC;
      --text-dark: #0F1419;
      --text-light: #536471;
      --border: #D8D9DB;
      --white: #FFFFFF;
      --background: #F5F8FA;
      --dark-bg: #15202B;
      --dark-border: #2F3B43;
      --dark-text: #FFFFFF;
    }

    [data-theme="dark"] {
      --text-dark: var(--dark-text);
      --border: var(--dark-border);
      --white: var(--dark-bg);
      --background: #1E2A3C;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background: var(--white);
      color: var(--text-dark);
      min-height: 100vh;
      margin: 0;
      padding: 0;
      transition: background 0.3s ease, color 0.3s ease;
    }

    body.fade-out {
      opacity: 0;
    }

    .navbar {
      position: sticky;
      top: 0;
      left: 0;
      right: 0;
      background: var(--white);
      border-bottom: 1px solid var(--border);
      padding: 0.75rem 1rem;
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .navbar-links {
      display: flex;
      gap nearly 2rem;
      align-items: center;
      max-width: 600px;
      width: 100%;
    }

    .navbar-links a, .navbar-links button {
      color: var(--text-dark);
      font-size: 1rem;
      font-weight: 600;
      text-decoration: none;
      transition: color 0.2s ease;
    }

    .navbar-links a:hover, .navbar-links button:hover {
      color: var(--twitter-blue);
    }

    .navbar-links a.active {
      color: var(--twitter-blue);
      border-bottom: 2px solid var(--twitter-blue);
    }

    .theme-toggle {
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
    }

    .theme-toggle svg {
      width: 24px;
      height: 24px;
      fill: none;
      stroke: var(--text-dark);
      stroke-width: 2;
    }

    .loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .loading-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid transparent;
      border-top-color: var(--twitter-blue);
      border-right-color: var(--twitter-purple);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .spinner-text {
      color: var(--white);
      font-size: 0.9rem;
      font-weight: 500;
      margin-top: 0.5rem;
    }

    @media (max-width: 640px) {
      .navbar-links {
        gap: 1rem;
        justify-content: space-between;
      }

      .navbar-links a, .navbar-links button {
        font-size: 0.9rem;
      }

      .spinner {
        width: 40px;
        height: 40px;
      }

      .spinner-text {
        font-size: 0.8rem;
      }
    }

    .container {
      max-width: 600px;
      width: 100%;
      margin: 0 auto;
      padding: 0.75rem 1rem;
    }

    .tweet-compose {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      background: var(--white);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      border-radius: 12px;
      margin-bottom: 1rem;
      position: relative;
    }

    .tweet-compose textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 1rem;
      color: var(--text-dark);
      resize: none;
      outline: none;
      transition: border-color 0.2s ease;
    }

    .tweet-compose textarea:focus {
      border-color: var(--twitter-blue);
      box-shadow: 0 0 0 2px rgba(29, 161, 242, 0.2);
    }

    .tweet-compose textarea:disabled {
      background: var(--background);
      cursor: not-allowed;
    }

    .media-upload {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-top: 0.5rem;
    }

    .media-upload label, .media-upload button {
      cursor: pointer;
      color: var(--twitter-blue);
      font-size: 0.9rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      transition: transform 0.2s ease;
    }

    .media-upload label:hover, .media-upload button:hover {
      transform: scale(1.05);
    }

    .media-upload label:disabled, .media-upload button:disabled {
      color: var(--text-light);
      cursor: not-allowed;
      pointer-events: none;
      opacity: 0.5;
    }

    .media-upload label svg, .media-upload button svg {
      fill: var(--twitter-blue);
    }

    .media-upload input {
      display: none;
    }

    .voice-record-btn.recording {
      color: #ff0000;
    }

    .voice-record-btn.recording svg {
      fill: #ff0000;
    }

    .voice-record-btn svg {
      width: 20px;
      height: 20px;
    }

    .progress-bar {
      display: none;
      width: 100%;
      height: 4px;
      background: var(--border);
      border-radius: 2px;
      margin-top: 0.5rem;
    }

    .progress-bar.active {
      display: block;
    }

    .progress-bar div {
      height: 100%;
      background: linear-gradient(45deg, var(--twitter-blue), var(--twitter-purple));
      border-radius: 2px;
      transition: width 0.2s ease;
    }

    .tweet-btn {
      width: 100%;
      padding: 0.5rem 1.5rem;
      background: linear-gradient(45deg, var(--twitter-blue), var(--twitter-purple));
      color: var(--white);
      border: none;
      border-radius: 20px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      margin-top: 0.5rem;
    }

    .tweet-btn:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .tweet-btn:disabled {
      background: #66b0ff;
      cursor: not-allowed;
    }

    .tweet-feed {
      margin-top: 1rem;
    }

    .tweet {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      background: var(--white);
      border-radius: 12px;
      margin-bottom: 0.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      animation: fadeIn 0.5s ease-out;
    }

    .tweet:focus {
      outline: 2px solid var(--twitter-blue);
      outline-offset: 2px;
    }

    .tweet:hover {
      background: var(--background);
    }

    .tweet-header {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .tweet-avatar, .comment-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--text-light);
      color: var(--white);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      font-weight: 600;
      flex-shrink: 0;
    }

    .tweet-avatar img, .comment-avatar img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
    }

    .tweet-user-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }

    .tweet-username {
      font-weight: 700;
      color: var(--text-dark);
      font-size: 1rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tweet-username:hover {
      text-decoration: underline;
    }

    .tweet-username .handle {
      color: var(--text-light);
      font-weight: 0.875rem;
      display: block;
    }

    .tweet-timestamp {
      font-size: 0.8125rem;
      color: var(--text-light);
      margin-left: auto;
    }

    .tweet-content {
      font-size: 1rem;
      color: var(--text-dark);
      word-break: break-word;
      margin: 0.5rem 0;
    }

    .tweet-content a, .comment-content a {
      color: var(--twitter-blue);
      text-decoration: none;
    }

    .tweet-content a:hover, .comment-content a:hover {
      text-decoration: underline;
    }

    .tweet-media img,
    .tweet-media video,
    .tweet-media audio {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 0.5rem;
    }

    .tweet-actions {
      display: flex;
      justify-content: space-between;
      max-width: 360px;
      margin-top: 0.5rem;
    }

    .tweet-action, .comment-action {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-light);
      font-size: 0.8125rem;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .tweet-action.comment-btn span {
      color: var(--text-dark);
    }

    .tweet-action:focus, .comment-action:focus {
      outline: 2px solid var(--twitter-blue);
      outline-offset: 2px;
    }

    .tweet-action svg, .comment-action svg {
      width: 16px;
      height: 16px;
      fill: var(--text-light);
      stroke: var(--text-light);
      stroke-width: 1.5;
      transition: transform 0.2s ease;
    }

    [data-theme="dark"] .tweet-action svg, [data-theme="dark"] .comment-action svg {
      fill: var(--dark-text);
      stroke: var(--dark-text);
    }

    .tweet-action:hover svg, .comment-action:hover svg {
      transform: scale(1.1);
    }

    .tweet-action.comment-btn, .tweet-action.comment-btn svg {
      background: none;
    }

    .tweet-action.clicked svg, .tweet-action.retweeted svg, .tweet-action.liked svg,
    .tweet-action.delete-btn svg:hover,
    .comment-action.clicked svg, .comment-action.delete-btn svg:hover {
      fill: #000000;
      stroke: #000000;
      transform: scale(1.1);
    }

    .tweet-action:disabled, .comment-action:disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }

    .comments-section {
      margin-top: 0.5rem;
      border-top: 1px solid var(--border);
      padding-top: 0.5rem;
    }

    .comment {
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--border);
      margin-left: 48px;
      display: flex;
      gap: 0.75rem;
    }

    .comment.reply {
      margin-left: 56px;
    }

    .comment.hidden {
      display: none;
    }

    .comment-header {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      flex: 1;
    }

    .comment-username {
      font-weight: 600;
      color: var(--text-dark);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 50%;
    }

    .comment-username:hover {
      text-decoration: underline;
    }

    .comment-username .handle {
      color: var(--text-light);
      font-weight: 400;
    }

    .comment-content {
      font-size: 0.875rem;
      color: var(--text-dark);
      word-break: break-word;
    }

    .comment-actions {
      display: flex;
      gap: 1rem;
      margin-top: 0.25rem;
    }

    .show-more-btn {
      display: block;
      margin: 0.5rem auto;
      padding: 0.4rem 1rem;
      background: none;
      color: var(--twitter-blue);
      border: 1px solid var(--twitter-blue);
      border-radius: 20px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
    }

    .show-more-btn:hover {
      background: rgba(29, 161, 242, 0.1);
      transform: scale(1.02);
    }

    .modal, .confirm-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal.active, .confirm-modal.active {
      display: flex;
    }

    .modal-content, .confirm-content {
      background: var(--white);
      padding: 1.5rem;
      border-radius: 12px;
      max-width: 90%;
      width: 400px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      animation: fadeIn 0.3s ease-out;
      position: relative;
    }

    .modal-content textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 0.9rem;
      color: var(--text-dark);
      resize: none;
      outline: none;
      margin-bottom: 1rem;
    }

    .modal-content textarea:focus {
      border-color: var(--twitter-blue);
      box-shadow: 0 0 0 2px rgba(29, 161, 242, 0.2);
    }

    .modal-content button, .confirm-content button {
      padding: 0.5rem 1rem;
      margin: 0.5rem;
      border: none;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
    }

    .cancel-btn, .comment-btn, .confirm-btn {
      background: linear-gradient(45deg, var(--twitter-blue), var(--twitter-purple));
      color: var(--white);
    }

    .cancel-btn:hover, .comment-btn:hover, .confirm-btn:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .confirm-content p {
      font-size: 1rem;
      color: var(--text-dark);
      margin-bottom: 1rem;
    }

    .custom-alert {
      display: none;
      position: fixed;
      top: 1rem;
      left: 50%;
      transform: translateX(-50%);
      background: var(--white);
      padding: 1rem 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1001;
      color: var(--text-dark);
      font-weight: 500;
      text-align: center;
      max-width: 90%;
      width: 320px;
      animation: fadeIn 0.3s ease-out forwards;
      border: 1px solid var(--border);
    }

    .custom-alert.active {
      display: block;
    }

    .custom-alert .close-btn {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      width: 24px;
      height: 24px;
      background: none;
      border: none;
      color: #000000;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .custom-alert .close-btn:hover {
      transform: scale(1.2);
    }

    .custom-alert .close-btn svg {
      width: 100%;
      height: 100%;
      fill: none;
      stroke: #000000;
      stroke-width: 2;
    }

    .suggestion-dropdown {
      position: absolute;
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      max-height: 150px;
      overflow-y: auto;
      z-index: 1000;
      width: 100%;
      max-width: 300px;
      display: none;
    }

    .suggestion-dropdown.active {
      display: block;
    }

    .suggestion-item {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      color: var(--text-dark);
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .suggestion-item:hover, .suggestion-item.selected {
      background: rgba(29, 161, 242, 0.1);
    }

    @keyframes fadeIn {
      0% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
      100% { opacity: 1; transform: translateX(-50%) translateY(0); }
    }

    @media (max-width: 640px) {
      .container {
        padding: 0.75rem;
      }

      .tweet-compose {
        padding: 0.75rem;
      }

      .tweet-compose textarea {
        font-size: 0.95rem;
      }

      .tweet-btn {
        font-size: 0.95rem;
      }

      .tweet {
        padding: 0.75rem;
      }

      .tweet-avatar, .comment-avatar {
        width: 36px;
        height: 36px;
      }

      .tweet-username {
        font-size: 0.9375rem;
      }

      .tweet-username .handle {
        font-size: 0.8125rem;
      }

      .tweet-timestamp {
        font-size: 0.75rem;
      }

      .tweet-content {
        font-size: 0.9375rem;
      }

      .tweet-action svg, .comment-action svg {
        width: 14px;
        height: 14px;
      }

      .comment {
        margin-left: 40px;
      }

      .comment.reply {
        margin-left: 48px;
      }

      .suggestion-dropdown {
        max-width: 90%;
      }

      .media-upload label, .media-upload button {
        font-size: 0.85rem;
      }

      .media-upload svg {
        width: 18px;
        height: 18px;
      }
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="navbar-links">
      <a href="home.html" class="active">Home</a>
      <a href="friends.html">Friends</a>
      <a href="profile.html">Profile</a>
      <button class="logout-btn" aria-label="Log out">Logout</button>
      <button class="theme-toggle" aria-label="Toggle dark mode">
        <svg viewBox="0 0 24 24">
          <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
        </svg>
      </button>
    </div>
  </nav>
  <div class="container">
    <div class="custom-alert" id="alert">
      <span id="alert-message"></span>
      <button class="close-btn" aria-label="Close alert">
        <svg viewBox="0 0 24 24">
          <path d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <div class="loading-overlay" id="loading-overlay">
      <div class="spinner"></div>
      <span class="spinner-text">Loading...</span>
    </div>
    <div class="tweet-compose">
      <textarea id="tweet-input" rows="3" placeholder="What's happening?" aria-label="Compose tweet"></textarea>
      <div class="suggestion-dropdown" id="tweet-suggestions"></div>
      <div class="media-upload">
        <label for="image-upload" id="image-label" aria-label="Upload image">
          <svg viewBox="0 0 24 24">
            <path d="M19 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
          Image
        </label>
        <input type="file" id="image-upload" accept="image/*">
        <label for="video-upload" id="video-label" aria-label="Upload video">
          <svg viewBox="0 0 24 24">
            <path d="M18 3H6a2 2 0 00-2 2v14a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2zm-2 12H8v-6h8v6zm-2-2v-2l3 3-3 3v-2h-4v-2h4z"/>
          </svg>
          Video
        </label>
        <input type="file" id="video-upload" accept="video/*">
        <button id="voice-record-btn" class="voice-record-btn" aria-label="Record voice note">
          <svg viewBox="0 0 24 24">
            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.48 14.2 14.38 16 12 16s-4.48-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 2.84 2.76 5.01 5.91 5.01s5.42-2.17 5.91-5.01c.09-.6-.39-1.14-1-1.14z"/>
          </svg>
          <span id="voice-record-text">Record Voice</span>
        </button>
      </div>
      <div class="progress-bar" id="progress-bar">
        <div id="progress"></div>
      </div>
      <button class="tweet-btn" id="tweet-btn" disabled aria-label="Post tweet">Add Your Post</button>
    </div>
    <div class="tweet-feed" id="tweet-feed"></div>
  </div>
  <div class="modal" id="comment-modal">
    <div class="modal-content">
      <textarea id="comment-input" rows="4" placeholder="Write your comment..." aria-label="Compose comment"></textarea>
      <div class="suggestion-dropdown" id="comment-suggestions"></div>
      <button class="comment-btn" id="submit-comment" aria-label="Submit comment">Comment</button>
      <button class="cancel-btn" id="cancel-comment" aria-label="Cancel">Cancel</button>
    </div>
  </div>
  <div class="confirm-modal" id="confirm-modal">
    <div class="confirm-content">
      <p id="confirm-message"></p>
      <button class="confirm-btn" id="confirm-btn" aria-label="Confirm">Confirm</button>
      <button class="cancel-btn" id="cancel-confirm" aria-label="Cancel">Cancel</button>
    </div>
  </div>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
    import { getDatabase, ref, push, set, remove, get } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';

    const firebaseConfig = {
      apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
      authDomain: "fire-b-a8878.firebaseapp.com",
      databaseURL: "https://fire-b-a8878.firebaseio.com",
      projectId: "fire-b-a8878",
      storageBucket: "fire-b-a8878.firebasestorage.app",
      messagingSenderId: "658673187627",
      appId: "1:658673187627:web:6e4c29af661785f0afa36e",
      measurementId: "G-V4W97VMSKL"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const tweetInput = document.getElementById("tweet-input");
    const tweetBtn = document.getElementById("tweet-btn");
    const imageUpload = document.getElementById("image-upload");
    const videoUpload = document.getElementById("video-upload");
    const voiceRecordBtn = document.getElementById("voice-record-btn");
    const voiceRecordText = document.getElementById("voice-record-text");
    const imageLabel = document.getElementById("image-label");
    const videoLabel = document.getElementById("video-label");
    const tweetFeed = document.getElementById("tweet-feed");
    const commentModal = document.getElementById("comment-modal");
    const commentInput = document.getElementById("comment-input");
    const submitComment = document.getElementById("submit-comment");
    const cancelComment = document.getElementById("cancel-comment");
    const alert = document.getElementById("alert");
    const alertMessage = document.getElementById("alert-message");
    const progressBar = document.getElementById("progress-bar");
    const progress = document.getElementById("progress");
    const tweetSuggestions = document.getElementById("tweet-suggestions");
    const commentSuggestions = document.getElementById("comment-suggestions");
    const confirmModal = document.getElementById("confirm-modal");
    const confirmMessage = document.getElementById("confirm-message");
    const confirmBtn = document.getElementById("confirm-btn");
    const cancelConfirm = document.getElementById("cancel-confirm");
    const loadingOverlay = document.getElementById("loading-overlay");
    let currentTweetId = null;
    let replyToCommentId = null;
    let userHandles = {};
    let currentSuggestions = [];
    let selectedSuggestionIndex = -1;
    let currentUser = null;
    let mediaRecorder = null;
    let recordedChunks = [];
    let isRecording = false;

    const CLOUDINARY_CLOUD_NAME = "dqkujefxj";
    const CLOUDINARY_UPLOAD_PRESET = "banter_box";

    function showLoading() {
      loadingOverlay.classList.add("active");
    }

    function hideLoading() {
      loadingOverlay.classList.remove("active");
    }

    function getAvatarInitials(username) {
      return username ? username.charAt(0).toUpperCase() : "A";
    }

    function formatTimestamp(timestamp) {
      const now = Date.now();
      const diff = now - timestamp;
      const seconds = Math.floor(diff / 1000);
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);
      const days = Math.floor(hours / 24);
      if (days > 0) return `${days}d`;
      if (hours > 0) return `${hours}h`;
      if (minutes > 0) return `${minutes}m`;
      return `${seconds}s`;
    }

    function showAlert(message, isSuccess) {
      alertMessage.textContent = message;
      alert.style.background = isSuccess ? "rgba(29, 161, 242, 0.1)" : "rgba(255, 0, 0, 0.1)";
      alert.classList.add("active");
      setTimeout(() => alert.classList.remove("active"), 3000);
    }

    function showCustomConfirm(message) {
      return new Promise((resolve) => {
        confirmMessage.textContent = message;
        confirmModal.classList.add("active");
        const onConfirm = () => {
          confirmModal.classList.remove("active");
          resolve(true);
          confirmBtn.removeEventListener("click", onConfirm);
          cancelConfirm.removeEventListener("click", onCancel);
        };
        const onCancel = () => {
          confirmModal.classList.remove("active");
          resolve(false);
          confirmBtn.removeEventListener("click", onConfirm);
          cancelConfirm.removeEventListener("click", onCancel);
        };
        confirmBtn.addEventListener("click", onConfirm);
        cancelConfirm.addEventListener("click", onCancel);
        confirmModal.addEventListener("keydown", (event) => {
          if (event.key === "Enter") {
            onConfirm();
          } else if (event.key === "Escape") {
            onCancel();
          }
        }, { once: true });
      });
    }

    function toggleDarkMode() {
      const theme = document.body.dataset.theme === "dark" ? "light" : "dark";
      document.body.dataset.theme = theme;
      localStorage.setItem("theme", theme);
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function formatContentWithTags(text) {
      return text.replace(/@(\w+)/g, (match, handle) => {
        const uid = userHandles[handle.toLowerCase()];
        return uid ? `<a href="profile.html?uid=${uid}" class="tagged-user">@${handle}</a>` : match;
      });
    }

    function showSuggestions(input, suggestionsDiv, query) {
      suggestionsDiv.innerHTML = "";
      currentSuggestions = Object.keys(userHandles)
        .filter(handle => handle.toLowerCase().startsWith(query.toLowerCase()))
        .slice(0, 5);
      currentSuggestions.forEach((handle, index) => {
        const suggestionItem = document.createElement("div");
        suggestionItem.className = `suggestion-item ${index === selectedSuggestionIndex ? 'selected' : ''}`;
        suggestionItem.textContent = `@${handle}`;
        suggestionItem.addEventListener("click", () => selectSuggestion(input, suggestionsDiv, handle));
        suggestionsDiv.appendChild(suggestionItem);
      });
      suggestionsDiv.classList.toggle("active", currentSuggestions.length > 0);
      selectedSuggestionIndex = -1;
    }

    function selectSuggestion(input, suggestionsDiv, handle) {
      const words = input.value.substring(0, input.selectionStart).split(/\s+/);
      const lastWord = words[words.length - 1];
      if (lastWord.startsWith("@")) {
        const before = input.value.substring(0, input.selectionStart - lastWord.length);
        const after = input.value.substring(input.selectionStart);
        input.value = `${before}@${handle}${after ? ' ' + after : ''}`;
        input.focus();
      }
      suggestionsDiv.classList.remove("active");
      currentSuggestions = [];
      selectedSuggestionIndex = -1;
    }

    function handleInput(input, suggestionsDiv) {
      const cursorPosition = input.selectionStart;
      const textBeforeCursor = input.value.substring(0, cursorPosition);
      const words = textBeforeCursor.split(/\s+/);
      const lastWord = words[words.length - 1];
      if (lastWord.startsWith("@") && lastWord.length > 1) {
        const query = lastWord.substring(1);
        showSuggestions(input, suggestionsDiv, query);
      } else {
        suggestionsDiv.classList.remove("active");
        currentSuggestions = [];
        selectedSuggestionIndex = -1;
      }
    }

    function handleKeyDown(event, input, suggestionsDiv) {
      if (currentSuggestions.length === 0) return;
      if (event.key === "ArrowDown") {
        event.preventDefault();
        selectedSuggestionIndex = (selectedSuggestionIndex + 1) % currentSuggestions.length;
        updateSuggestionHighlight(suggestionsDiv);
      } else if (event.key === "ArrowUp") {
        event.preventDefault();
        selectedSuggestionIndex = (selectedSuggestionIndex - 1 + currentSuggestions.length) % currentSuggestions.length;
        updateSuggestionHighlight(suggestionsDiv);
      } else if (event.key === "Enter" && selectedSuggestionIndex >= 0) {
        event.preventDefault();
        selectSuggestion(input, suggestionsDiv, currentSuggestions[selectedSuggestionIndex]);
      } else if (event.key === "Escape") {
        suggestionsDiv.classList.remove("active");
        currentSuggestions = [];
        selectedSuggestionIndex = -1;
      }
    }

    function updateSuggestionHighlight(suggestionsDiv) {
      const items = suggestionsDiv.querySelectorAll(".suggestion-item");
      items.forEach((item, index) => {
        item.classList.toggle("selected", index === selectedSuggestionIndex);
      });
    }

    function initializeMediaRecorder() {
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        showAlert("Your browser does not support audio recording.", false);
        voiceRecordBtn.disabled = true;
        return;
      }
      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(stream => {
          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.ondataavailable = event => {
            if (event.data.size > 0) {
              recordedChunks.push(event.data);
            }
          };
          mediaRecorder.onstop = async () => {
            const audioBlob = new Blob(recordedChunks, { type: 'audio/webm' });
            recordedChunks = [];
            voiceRecordBtn.classList.remove("recording");
            voiceRecordText.textContent = "Record Voice";
            isRecording = false;
            tweetBtn.disabled = tweetInput.value.trim() === "" && !audioBlob.size && !imageUpload.files[0] && !videoUpload.files[0];
            voiceRecordBtn.dataset.audioBlob = URL.createObjectURL(audioBlob);
            imageUpload.disabled = false;
            videoUpload.disabled = false;
            imageLabel.style.pointerEvents = "auto";
            videoLabel.style.pointerEvents = "auto";
            imageLabel.style.opacity = 1;
            videoLabel.style.opacity = 1;
          };
        })
        .catch(error => {
          showAlert("Failed to access microphone: " + error.message, false);
          voiceRecordBtn.disabled = true;
        });
    }

    async function uploadMedia(file, type) {
      if (!auth.currentUser) {
        showAlert("You must be logged in to upload media.", false);
        return null;
      }

      console.log("File details:", {
        name: file.name || "media." + (type === "image" ? "png" : type === "video" ? "mp4" : "webm"),
        type: file.type,
        size: file.size
      });

      if (file.size > 5 * 1024 * 1024) {
        throw new Error("Media size must be less than 5MB");
      }

      const isImage = type === "image";
      const isVideo = type === "video";
      const isAudio = type === "audio";
      if (!isImage && !isVideo && !isAudio) {
        throw new Error("Invalid media type.");
      }

      const allowedImageTypes = ["image/jpeg", "image/png"];
      const allowedVideoTypes = ["video/mp4", "video/webm"];
      const allowedAudioTypes = ["audio/webm", "audio/mp3"];
      if (isImage && !allowedImageTypes.includes(file.type)) {
        throw new Error("Only JPG or PNG images are allowed.");
      }
      if (isVideo && !allowedVideoTypes.includes(file.type)) {
        throw new Error("Only MP4 or WEBM videos are allowed.");
      }
      if (isAudio && !allowedAudioTypes.includes(file.type)) {
        throw new Error("Only WEBM or MP3 audio files are allowed.");
      }

      const formData = new FormData();
      formData.append("file", file);
      formData.append("upload_preset", CLOUDINARY_UPLOAD_PRESET);
      formData.append("resource_type", type);
      formData.append("context", `user_id=${auth.currentUser.uid}`);

      progressBar.classList.add("active");
      progress.style.width = "0%";
      showLoading();

      try {
        const xhr = new XMLHttpRequest();
        const uploadEndpoint = isImage
          ? `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`
          : isVideo
          ? `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/video/upload`
          : `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/audio/upload`;
        xhr.open("POST", uploadEndpoint, true);
        xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");
        xhr.upload.addEventListener("progress", (event) => {
          if (event.lengthComputable) {
            const percent = Math.round((event.loaded / event.total) * 100);
            progress.style.width = `${percent}%`;
          }
        });

        const response = await new Promise((resolve, reject) => {
          xhr.onload = () => {
            if (xhr.status >= 200 && xhr.status < 300) {
              resolve(JSON.parse(xhr.responseText));
            } else {
              const errorMsg = xhr.responseText ? JSON.parse(xhr.responseText).error?.message : xhr.statusText;
              reject(new Error(`Cloudinary upload failed: ${errorMsg || "Unknown error"}`));
            }
          };
          xhr.onerror = () => reject(new Error("Network error during upload."));
          xhr.send(formData);
        });

        if (!response.secure_url) {
          throw new Error("No secure URL returned from Cloudinary");
        }

        setTimeout(() => progressBar.classList.remove("active"), 500);
        hideLoading();
        return response.secure_url;
      } catch (error) {
        progressBar.classList.remove("active");
        hideLoading();
        throw error;
      }
    }

    function renderTweet(tweetData, tweetId, user, userProfiles) {
      const tweetDiv = document.createElement("div");
      tweetDiv.className = "tweet";
      tweetDiv.dataset.tweetId = tweetId;
      tweetDiv.tabIndex = 0;
      let mediaHtml = "";
      if (tweetData.mediaUrl && tweetData.mediaType) {
        if (tweetData.mediaType === "image") {
          mediaHtml = `<div class="tweet-media"><img src="${tweetData.mediaUrl}" alt="Tweet media" /></div>`;
        } else if (tweetData.mediaType === "video") {
          const posterUrl = tweetData.mediaUrl.replace(/\.mp4$|\.webm$/, '.jpg');
          mediaHtml = `<div class="tweet-media"><video loop playsinline src="${tweetData.mediaBondi
System: I notice the code was cut off again. Below is the complete, updated code for `home.html`, ensuring all functionality is included, with voice note support and the handle displayed below the username for all tweets. I've carefully integrated the requested features while preserving your existing implementation, including Firebase integration, Cloudinary uploads, user tagging, custom alerts, and more.

### Full Code
```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>X Home</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --twitter-blue: #1DA1F2;
      --twitter-purple: #8A3FFC;
      --text-dark: #0F1419;
      --text-light: #536471;
      --border: #D8D9DB;
      --white: #FFFFFF;
      --background: #F5F8FA;
      --dark-bg: #15202B;
      --dark-border: #2F3B43;
      --dark-text: #FFFFFF;
    }

    [data-theme="dark"] {
      --text-dark: var(--dark-text);
      --border: var(--dark-border);
      --white: var(--dark-bg);
      --background: #1E2A3C;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background: var(--white);
      color: var(--text-dark);
      min-height: 100vh;
      margin: 0;
      padding: 0;
      transition: background 0.3s ease, color 0.3s ease;
    }

    body.fade-out {
      opacity: 0;
    }

    .navbar {
      position: sticky;
      top: 0;
      left: 0;
      right: 0;
      background: var(--white);
      border-bottom: 1px solid var(--border);
      padding: 0.75rem 1rem;
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .navbar-links {
      display: flex;
      gap: 2rem;
      align-items: center;
      max-width: 600px;
      width: 100%;
    }

    .navbar-links a, .navbar-links button {
      color: var(--text-dark);
      font-size: 1rem;
      font-weight: 600;
      text-decoration: none;
      transition: color 0.2s ease;
    }

    .navbar-links a:hover, .navbar-links button:hover {
      color: var(--twitter-blue);
    }

    .navbar-links a.active {
      color: var(--twitter-blue);
      border-bottom: 2px solid var(--twitter-blue);
    }

    .theme-toggle {
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
    }

    .theme-toggle svg {
      width: 24px;
      height: 24px;
      fill: none;
      stroke: var(--text-dark);
      stroke-width: 2;
    }

    .loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .loading-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid transparent;
      border-top-color: var(--twitter-blue);
      border-right-color: var(--twitter-purple);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .spinner-text {
      color: var(--white);
      font-size: 0.9rem;
      font-weight: 500;
      margin-top: 0.5rem;
    }

    @media (max-width: 640px) {
      .navbar-links {
        gap: 1rem;
        justify-content: space-between;
      }

      .navbar-links a, .navbar-links button {
        font-size: 0.9rem;
      }

      .spinner {
        width: 40px;
        height: 40px;
      }

      .spinner-text {
        font-size: 0.8rem;
      }
    }

    .container {
      max-width: 600px;
      width: 100%;
      margin: 0 auto;
      padding: 0.75rem 1rem;
    }

    .tweet-compose {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      background: var(--white);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      border-radius: 12px;
      margin-bottom: 1rem;
      position: relative;
    }

    .tweet-compose textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 1rem;
      color: var(--text-dark);
      resize: none;
      outline: none;
      transition: border-color 0.2s ease;
    }

    .tweet-compose textarea:focus {
      border-color: var(--twitter-blue);
      box-shadow: 0 0 0 2px rgba(29, 161, 242, 0.2);
    }

    .tweet-compose textarea:disabled {
      background: var(--background);
      cursor: not-allowed;
    }

    .media-upload {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-top: 0.5rem;
    }

    .media-upload label, .media-upload button {
      cursor: pointer;
      color: var(--twitter-blue);
      font-size: 0.9rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      transition: transform 0.2s ease;
    }

    .media-upload label:hover, .media-upload button:hover {
      transform: scale(1.05);
    }

    .media-upload label:disabled, .media-upload button:disabled {
      color: var(--text-light);
      cursor: not-allowed;
      pointer-events: none;
      opacity: 0.5;
    }

    .media-upload label svg, .media-upload button svg {
      fill: var(--twitter-blue);
    }

    .media-upload input {
      display: none;
    }

    .voice-record-btn.recording {
      color: #ff0000;
    }

    .voice-record-btn.recording svg {
      fill: #ff0000;
    }

    .voice-record-btn svg {
      width: 20px;
      height: 20px;
    }

    .progress-bar {
      display: none;
      width: 100%;
      height: 4px;
      background: var(--border);
      border-radius: 2px;
      margin-top: 0.5rem;
    }

    .progress-bar.active {
      display: block;
    }

    .progress-bar div {
      height: 100%;
      background: linear-gradient(45deg, var(--twitter-blue), var(--twitter-purple));
      border-radius: 2px;
      transition: width 0.2s ease;
    }

    .tweet-btn {
      width: 100%;
      padding: 0.5rem 1.5rem;
      background: linear-gradient(45deg, var(--twitter-blue), var(--twitter-purple));
      color: var(--white);
      border: none;
      border-radius: 20px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      margin-top: 0.5rem;
    }

    .tweet-btn:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .tweet-btn:disabled {
      background: #66b0ff;
      cursor: not-allowed;
    }

    .tweet-feed {
      margin-top: 1rem;
    }

    .tweet {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      background: var(--white);
      border-radius: 12px;
      margin-bottom: 0.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      animation: fadeIn 0.5s ease-out;
    }

    .tweet:focus {
      outline: 2px solid var(--twitter-blue);
      outline-offset: 2px;
    }

    .tweet:hover {
      background: var(--background);
    }

    .tweet-header {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .tweet-avatar, .comment-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--text-light);
      color: var(--white);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      font-weight: 600;
      flex-shrink: 0;
    }

    .tweet-avatar img, .comment-avatar img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
    }

    .tweet-user-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }

    .tweet-username {
      font-weight: 700;
      color: var(--text-dark);
      font-size: 1rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tweet-username:hover {
      text-decoration: underline;
    }

    .tweet-username .handle {
      color: var(--text-light);
      font-weight: 400;
      font-size: 0.875rem;
      display: block;
    }

    .tweet-timestamp {
      font-size: 0.8125rem;
      color: var(--text-light);
      margin-left: auto;
    }

    .tweet-content {
      font-size: 1rem;
      color: var(--text-dark);
      word-break: break-word;
      margin: 0.5rem 0;
    }

    .tweet-content a, .comment-content a {
      color: var(--twitter-blue);
      text-decoration: none;
    }

    .tweet-content a:hover, .comment-content a:hover {
      text-decoration: underline;
    }

    .tweet-media img,
    .tweet-media video,
    .tweet-media audio {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 0.5rem;
    }

    .tweet-actions {
      display: flex;
      justify-content: space-between;
      max-width: 360px;
      margin-top: 0.5rem;
    }

    .tweet-action, .comment-action {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-light);
      font-size: 0.8125rem;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .tweet-action.comment-btn span {
      color: var(--text-dark);
    }

    .tweet-action:focus, .comment-action:focus {
      outline: 2px solid var(--twitter-blue);
      outline-offset: 2px;
    }

    .tweet-action svg, .comment-action svg {
      width: 16px;
      height: 16px;
      fill: var(--text-light);
      stroke: var(--text-light);
      stroke-width: 1.5;
      transition: transform 0.2s ease;
    }

    [data-theme="dark"] .tweet-action svg, [data-theme="dark"] .comment-action svg {
      fill: var(--dark-text);
      stroke: var(--dark-text);
    }

    .tweet-action:hover svg, .comment-action:hover svg {
      transform: scale(1.1);
    }

    .tweet-action.comment-btn, .tweet-action.comment-btn svg {
      background: none;
    }

    .tweet-action.clicked svg, .tweet-action.retweeted svg, .tweet-action.liked svg,
    .tweet-action.delete-btn svg:hover,
    .comment-action.clicked svg, .comment-action.delete-btn svg:hover {
      fill: #000000;
      stroke: #000000;
      transform: scale(1.1);
    }

    .tweet-action:disabled, .comment-action:disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }

    .comments-section {
      margin-top: 0.5rem;
      border-top: 1px solid var(--border);
      padding-top: 0.5rem;
    }

    .comment {
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--border);
      margin-left: 48px;
      display: flex;
      gap: 0.75rem;
    }

    .comment.reply {
      margin-left: 56px;
    }

    .comment.hidden {
      display: none;
    }

    .comment-header {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      flex: 1;
    }

    .comment-username {
      font-weight: 600;
      color: var(--text-dark);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 50%;
    }

    .comment-username:hover {
      text-decoration: underline;
    }

    .comment-username .handle {
      color: var(--text-light);
      font-weight: 400;
    }

    .comment-content {
      font-size: 0.875rem;
      color: var(--text-dark);
      word-break: break-word;
    }

    .comment-actions {
      display: flex;
      gap: 1rem;
      margin-top: 0.25rem;
    }

    .show-more-btn {
      display: block;
      margin: 0.5rem auto;
      padding: 0.4rem 1rem;
      background: none;
      color: var(--twitter-blue);
      border: 1px solid var(--twitter-blue);
      border-radius: 20px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
    }

    .show-more-btn:hover {
      background: rgba(29, 161, 242, 0.1);
      transform: scale(1.02);
    }

    .modal, .confirm-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal.active, .confirm-modal.active {
      display: flex;
    }

    .modal-content, .confirm-content {
      background: var(--white);
      padding: 1.5rem;
      border-radius: 12px;
      max-width: 90%;
      width: 400px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      animation: fadeIn 0.3s ease-out;
      position: relative;
    }

    .modal-content textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 0.9rem;
      color: var(--text-dark);
      resize: none;
      outline: none;
      margin-bottom: 1rem;
    }

    .modal-content textarea:focus {
      border-color: var(--twitter-blue);
      box-shadow: 0 0 0 2px rgba(29, 161, 242, 0.2);
    }

    .modal-content button, .confirm-content button {
      padding: 0.5rem 1rem;
      margin: 0.5rem;
      border: none;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
    }

    .cancel-btn, .comment-btn, .confirm-btn {
      background: linear-gradient(45deg, var(--twitter-blue), var(--twitter-purple));
      color: var(--white);
    }

    .cancel-btn:hover, .comment-btn:hover, .confirm-btn:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .confirm-content p {
      font-size: 1rem;
      color: var(--text-dark);
      margin-bottom: 1rem;
    }

    .custom-alert {
      display: none;
      position: fixed;
      top: 1rem;
      left: 50%;
      transform: translateX(-50%);
      background: var(--white);
      padding: 1rem 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1001;
      color: var(--text-dark);
      font-weight: 500;
      text-align: center;
      max-width: 90%;
      width: 320px;
      animation: fadeIn 0.3s ease-out forwards;
      border: 1px solid var(--border);
    }

    .custom-alert.active {
      display: block;
    }

    .custom-alert .close-btn {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      width: 24px;
      height: 24px;
      background: none;
      border: none;
      color: #000000;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .custom-alert .close-btn:hover {
      transform: scale(1.2);
    }

    .custom-alert .close-btn svg {
      width: 100%;
      height: 100%;
      fill: none;
      stroke: #000000;
      stroke-width: 2;
    }

    .suggestion-dropdown {
      position: absolute;
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      max-height: 150px;
      overflow-y: auto;
      z-index: 1000;
      width: 100%;
      max-width: 300px;
      display: none;
    }

    .suggestion-dropdown.active {
      display: block;
    }

    .suggestion-item {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      color: var(--text-dark);
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .suggestion-item:hover, .suggestion-item.selected {
      background: rgba(29, 161, 242, 0.1);
    }

    @keyframes fadeIn {
      0% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
      100% { opacity: 1; transform: translateX(-50%) translateY(0); }
    }

    @media (max-width: 640px) {
      .container {
        padding: 0.75rem;
      }

      .tweet-compose {
        padding: 0.75rem;
      }

      .tweet-compose textarea {
        font-size: 0.95rem;
      }

      .tweet-btn {
        font-size: 0.95rem;
      }

      .tweet {
        padding: 0.75rem;
      }

      .tweet-avatar, .comment-avatar {
        width: 36px;
        height: 36px;
      }

      .tweet-username {
        font-size: 0.9375rem;
      }

      .tweet-username .handle {
        font-size: 0.8125rem;
      }

      .tweet-timestamp {
        font-size: 0.75rem;
      }

      .tweet-content {
        font-size: 0.9375rem;
      }

      .tweet-action svg, .comment-action svg {
        width: 14px;
        height: 14px;
      }

      .comment {
        margin-left: 40px;
      }

      .comment.reply {
        margin-left: 48px;
      }

      .suggestion-dropdown {
        max-width: 90%;
      }

      .media-upload label, .media-upload button {
        font-size: 0.85rem;
      }

      .media-upload svg {
        width: 18px;
        height: 18px;
      }
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="navbar-links">
      <a href="home.html" class="active">Home</a>
      <a href="friends.html">Friends</a>
      <a href="profile.html">Profile</a>
      <button class="logout-btn" aria-label="Log out">Logout</button>
      <button class="theme-toggle" aria-label="Toggle dark mode">
        <svg viewBox="0 0 24 24">
          <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
        </svg>
      </button>
    </div>
  </nav>
  <div class="container">
    <div class="custom-alert" id="alert">
      <span id="alert-message"></span>
      <button class="close-btn" aria-label="Close alert">
        <svg viewBox="0 0 24 24">
          <path d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <div class="loading-overlay" id="loading-overlay">
      <div class="spinner"></div>
      <span class="spinner-text">Loading...</span>
    </div>
    <div class="tweet-compose">
      <textarea id="tweet-input" rows="3" placeholder="What's happening?" aria-label="Compose tweet"></textarea>
      <div class="suggestion-dropdown" id="tweet-suggestions"></div>
      <div class="media-upload">
        <label for="image-upload" id="image-label" aria-label="Upload image">
          <svg viewBox="0 0 24 24">
            <path d="M19 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
          Image
        </label>
        <input type="file" id="image-upload" accept="image/*">
        <label for="video-upload" id="video-label" aria-label="Upload video">
          <svg viewBox="0 0 24 24">
            <path d="M18 3H6a2 2 0 00-2 2v14a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2zm-2 12H8v-6h8v6zm-2-2v-2l3 3-3 3v-2h-4v-2h4z"/>
          </svg>
          Video
        </label>
        <input type="file" id="video-upload" accept="video/*">
        <button id="voice-record-btn" class="voice-record-btn" aria-label="Record voice note">
          <svg viewBox="0 0 24 24">
            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.48 14.2 14.38 16 12 16s-4.48-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 2.84 2.76 5.01 5.91 5.01s5.42-2.17 5.91-5.01c.09-.6-.39-1.14-1-1.14z"/>
          </svg>
          <span id="voice-record-text">Record Voice</span>
        </button>
      </div>
      <div class="progress-bar" id="progress-bar">
        <div id="progress"></div>
      </div>
      <button class="tweet-btn" id="tweet-btn" disabled aria-label="Post tweet">Add Your Post</button>
    </div>
    <div class="tweet-feed" id="tweet-feed"></div>
  </div>
  <div class="modal" id="comment-modal">
    <div class="modal-content">
      <textarea id="comment-input" rows="4" placeholder="Write your comment..." aria-label="Compose comment"></textarea>
      <div class="suggestion-dropdown" id="comment-suggestions"></div>
      <button class="comment-btn" id="submit-comment" aria-label="Submit comment">Comment</button>
      <button class="cancel-btn" id="cancel-comment" aria-label="Cancel">Cancel</button>
    </div>
  </div>
  <div class="confirm-modal" id="confirm-modal">
    <div class="confirm-content">
      <p id="confirm-message"></p>
      <button class="confirm-btn" id="confirm-btn" aria-label="Confirm">Confirm</button>
      <button class="cancel-btn" id="cancel-confirm" aria-label="Cancel">Cancel</button>
    </div>
  </div>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
    import { getDatabase, ref, push, set, remove, get } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';

    const firebaseConfig = {
      apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
      authDomain: "fire-b-a8878.firebaseapp.com",
      databaseURL: "https://fire-b-a8878.firebaseio.com",
      projectId: "fire-b-a8878",
      storageBucket: "fire-b-a8878.firebasestorage.app",
      messagingSenderId: "658673187627",
      appId: "1:658673187627:web:6e4c29af661785f0afa36e",
      measurementId: "G-V4W97VMSKL"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const tweetInput = document.get NH1; document.getElementById("tweet-input");
    const tweetBtn = document.getElementById("tweet-btn");
    const imageUpload = document.getElementById("image-upload");
    const videoUpload = document.getElementById("video-upload");
    const voiceRecordBtn = document.getElementById("voice-record-btn");
    const voiceRecordText = document.getElementById("voice-record-text");
    const imageLabel = document.getElementById("image-label");
    const videoLabel = document.getElementById("video-label");
    const tweetFeed = document.getElementById("tweet-feed");
    const commentModal = document.getElementById("comment-modal");
    const commentInput = document.getElementById("comment-input");
    const submitComment = document.getElementById("submit-comment");
    const cancelComment = document.getElementById("cancel-comment");
    const alert = document.getElementById("alert");
    const alertMessage = document.getElementById("alert-message");
    const progressBar = document.getElementById("progress-bar");
    const progress = document.getElementById("progress");
    const tweetSuggestions = document.getElementById("tweet-suggestions");
    const commentSuggestions = document.getElementById("comment-suggestions");
    const confirmModal = document.getElementById("confirm-modal");
    const confirmMessage = document.getElementById("confirm-message");
    const confirmBtn = document.getElementById("confirm-btn");
    const cancelConfirm = document.getElementById("cancel-confirm");
    const loadingOverlay = document.getElementById("loading-overlay");
    let currentTweetId = null;
    let replyToCommentId = null;
    let userHandles = {};
    let
