<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YouTube</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Roboto', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #181818;
    }
    .sidebar {
      width: 240px;
      position: fixed;
      top: 0;
      left: -240px;
      height: 100%;
      transition: left 0.3s ease;
      z-index: 1000;
    }
    .sidebar.open {
      left: 0;
    }
    .animate-spin-slow {
      animation: spin 4s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .loader-container {
      display: none;
      justify-content: center;
      align-items: center;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 9999;
    }
    .tutor-card, .post-card {
      transition: transform 0.2s;
    }
    .tutor-card:hover, .post-card:hover {
      transform: scale(1.02);
    }
    .btn-pay, .btn-like, .btn-comment {
      background-color: #282828;
      color: #fff;
      transition: background-color 0.2s;
    }
    .btn-pay:hover, .btn-like:hover, .btn-comment:hover {
      background-color: #ff0000;
    }
    .btn-like.liked svg {
      fill: #ff0000;
    }
    .header-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
    }
    .left-container {
      display: flex;
      align-items: center;
      flex-shrink: 0;
    }
    .logo-container {
      display: flex;
      align-items: center;
      min-width: 150px;
      transition: visibility 0.3s ease, opacity 0.3s ease;
    }
    .logo-container.hidden {
      visibility: hidden;
      opacity: 0;
      min-width: 0;
    }
    .search-container {
      flex: 1;
      max-width: 400px;
      margin: 0 16px;
      transition: max-width 0.3s ease, margin-left 0.3s ease;
    }
    .search-container.focused {
      max-width: 550px;
      margin-left: -134px;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background-color: #282828;
      padding: 24px;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
      max-height: 80vh;
      overflow-y: auto;
    }
    .modal-content input, .modal-content textarea {
      background-color: #121212;
      border: 1px solid #444;
      color: #fff;
    }
    .modal-content button {
      transition: background-color 0.2s;
    }
    .bottom-nav {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: #212121;
      z-index: 1000;
      padding: 8px 0;
    }
    .bottom-nav a {
      flex: 1;
      text-align: center;
      color: #fff;
      padding: 8px;
      transition: background-color 0.2s;
    }
    .bottom-nav a:hover,
    .bottom-nav a.active {
      background-color: #ff0000;
    }
    .tab-btn {
      background-color: #282828;
      color: #fff;
      padding: 8px 16px;
      border-radius: 4px;
      transition: background-color 0.2s;
    }
    .tab-btn.active {
      background-color: #ff0000;
    }
    .tab-btn:hover {
      background-color: #cc0000;
    }
    #mind-input {
      background-color: #282828;
      border: 1px solid #444;
      color: #fff;
      padding: 12px;
      border-radius: 20px;
      width: 100%;
      max-width: 500px;
      cursor: pointer;
    }
    #mind-input:focus {
      border-color: #ff0000;
      outline: none;
    }
    .post-card {
      padding: 1.5rem;
    }
    .post-image {
      height: 16rem;
    }
    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }
      .bottom-nav {
        display: flex;
      }
      .main-content {
        margin-bottom: 64px;
      }
      .logo-container {
        min-width: 100px;
      }
      .search-container {
        max-width: 250px;
        margin: 0 8px;
      }
      .search-container.focused {
        max-width: 350px;
        margin-left: -92px;
      }
      .right-container {
        flex-shrink: 0;
      }
      .header-container {
        padding: 0 8px;
      }
      .tab-btn {
        flex: 1;
        text-align: center;
      }
      #mind-input {
        max-width: 100%;
      }
      .post-actions {
        flex-wrap: wrap;
        gap: 8px;
      }
    }
    @media (min-width: 769px) {
      .bottom-nav {
        display: none;
      }
    }
    #search-bar {
      width: 100%;
      transition: width 0.3s ease;
    }
    .category-filter {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    .category-filter::-webkit-scrollbar {
      display: none;
    }
    .category-btn {
      white-space: nowrap;
      transition: background-color 0.2s;
    }
    .category-btn.active {
      background-color: #ff0000;
    }
    .category-btn:hover {
      background-color: #cc0000;
    }
  </style>
</head>
<body class="bg-[#181818] text-white">
  <!-- ðŸ”¹ Loader Overlay -->
  <div id="loader-overlay" class="loader-container">
    <svg width="80" height="80" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg" class="animate-spin-slow">
      <circle cx="60" cy="60" r="50" stroke="#ff0000" stroke-width="6" stroke-linecap="round" stroke-dasharray="240" stroke-dashoffset="60">
        <animate attributeName="stroke-dashoffset" values="60;300" dur="2s" repeatCount="indefinite"/>
      </circle>
    </svg>
  </div>

  <!-- ðŸ”¹ Code Entry Modal -->
  <div id="code-modal" class="modal">
    <div class="modal-content">
      <h2 class="text-xl font-bold mb-4">Enter Lesson Code</h2>
      <input type="text" id="code-input" maxlength="8" placeholder="Enter 8-character code" class="w-full px-4 py-2 rounded-md mb-4 focus:outline-none focus:border-red-500" />
      <p id="modal-error" class="text-sm text-red-500 mb-4 hidden"></p>
      <div class="flex justify-end space-x-2">
        <button id="modal-cancel" class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700">Cancel</button>
        <button id="modal-submit" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">Submit</button>
      </div>
    </div>
  </div>

  <!-- ðŸ”¹ Post Creation Modal -->
  <div id="post-modal" class="modal">
    <div class="modal-content">
      <h2 class="text-xl font-bold mb-4">Create a Post</h2>
      <div class="mb-4">
        <label class="block mb-2">
          <input type="radio" name="post-type" value="text" checked class="mr-2"> Text
        </label>
        <label class="block mb-2">
          <input type="radio" name="post-type" value="image" class="mr-2"> Image URL
        </label>
      </div>
      <div id="text-input-container" class="mb-4">
        <textarea id="post-text" rows="4" class="w-full px-4 py-2 rounded-md focus:outline-none focus:border-red-500" placeholder="What's on your mind?"></textarea>
      </div>
      <div id="image-input-container" class="mb-4 hidden">
        <input type="url" id="post-image" class="w-full px-4 py-2 rounded-md focus:outline-none focus:border-red-500" placeholder="Enter image URL" />
      </div>
      <p id="post-error" class="text-sm text-red-500 mb-4 hidden"></p>
      <div class="flex justify-end space-x-2">
        <button id="post-cancel" class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700">Cancel</button>
        <button id="post-submit" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">Submit</button>
      </div>
    </div>
  </div>

  <!-- ðŸ”¹ Comment Modal -->
  <div id="comment-modal" class="modal">
    <div class="modal-content">
      <h2 class="text-xl font-bold mb-4">Comments</h2>
      <div id="comment-list" class="mb-4"></div>
      <textarea id="comment-input" rows="3" class="w-full px-4 py-2 rounded-md mb-4 focus:outline-none focus:border-red-500" placeholder="Add a comment..."></textarea>
      <p id="comment-error" class="text-sm text-red-500 mb-4 hidden"></p>
      <div class="flex justify-end space-x-2">
        <button id="comment-cancel" class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700">Cancel</button>
        <button id="comment-submit" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">Submit</button>
      </div>
    </div>
  </div>

  <!-- ðŸ”¹ Header -->
  <header class="bg-[#212121] p-4 fixed top-0 left-0 right-0 z-10">
    <div class="header-container mx-auto max-w-7xl">
      <div class="left-container">
        <button id="menu-btn" class="mr-4 text-white">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/>
          </svg>
        </button>
        <div id="logo-container" class="logo-container">
          <svg class="w-8 h-8 mr-2" viewBox="0 0 24 24" fill="#ff0000">
            <path d="M23.5 6.2c-.3-1.1-1.2-2-2.3-2.3C19.4 3.5 12 3.5 12 3.5s-7.4 0-9.2.4c-1.1.3-2 1.2-2.3 2.3C.1 8 0 10.6 0 12s0 4 .5 5.8c.3 1.1 1.2 2 2.3 2.3 1.8.4 9.2.4 9.2.4s7.4 0 9.2-.4c-1.1-.3 2-1.2 2.3-2.3.5-1.8.5-4.4.5-5.8s0-4-.5-5.8zM9.5 15.5V8.5l6 3.5-6 3.5z"/>
          </svg>
          <h1 class="text-xl font-bold">YouTube</h1>
        </div>
      </div>
      <div id="search-container" class="search-container">
        <input type="text" id="search-bar" placeholder="Search" class="px-4 py-2 bg-[#121212] border border-gray-600 rounded-full text-white focus:outline-none focus:border-red-500" />
      </div>
      <div id="right-container" class="right-container flex items-center space-x-4">
        <img id="user-pic" class="w-8 h-8 rounded-full border border-gray-600" src="https://www.gravatar.com/avatar?d=mp" alt="Profile Pic" />
      </div>
    </div>
  </header>

  <!-- ðŸ”¹ Sidebar -->
  <div id="sidebar" class="sidebar bg-[#212121] p-4">
    <div class="space-y-4">
      <a href="home.html" class="flex items-center text-white hover:bg-[#383838] p-2 rounded-md active">
        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7-7 7M5 10v10a1 1 001 1h3m10-11l2 2m-2-2v10a1 1 01-1 1h-3m-6 0a1 1 001-1v-4a1 1 011-1h2a1 1 011 1v4a1 1 001 1m-6 0h6"/>
        </svg>
        Home
      </a>
      <a href="#" class="flex items-center text-white hover:bg-[#383838] p-2 rounded-md">
        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8h2a2 2 012 2v6a2h-2v4l-4-4H9a1.994 1.9940 01-1.414-.586m0 0L11 14h4a2 2 002-2V6a2h2H5a2 002-2v6a0 002 2h2v4l.586-.586z"/>
        </svg>
        Trending
      </a>
      <a href="#" class="flex items-center text-white hover:bg-[#383838] p-2 rounded-md">
        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 016.138 21H7.862a2 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a-1h-4a-1 00-1 1v3M4 7h16"/>
        </svg>
        Subscriptions
      </a>
      <a href="tutors.html" id="tutors-dashboard" class="flex items-center text-white hover:bg-[#383838] p-2 rounded-md">
        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5 5zm0 0l6.16-3.422a12.083 12.083.0 01.665 6.479A11.952 0 0012 20.055a11.952 0 00-6.824-2.998 12.078 01.665-6.479L12 14zm-4 6v-7.5l4-2.222"/>
</svg>
        Tutors Dashboard
      </a>
      <a href="admin-login.php" id="admin-panel" class="flex items-center text-white hover:bg-[#383838] p-2 rounded-md">
        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 0 0012 20.055a11.952 0 00-6.824-2.998 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222"/>
</svg>
        Admin Panel
      </a>
      <a href="#" id="sign-out" class="flex items-center text-white hover:bg-[#383838] p-2 rounded-md">
        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
</svg>
        Sign Out
      </a>
    </div>
  </div>

  <!-- ðŸ”¹ Bottom Navigation Bar -->
  <nav class="bottom-nav">
    <a href="home.html" class="active">
      <svg class="w-6 h-6 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
</svg>
      <span class="text-xs">Home</span>
    </a>
    <a href="#" class="flex items-center text-center">
      <svg class="w-6 h-6 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z"/>
</svg>
      <span class="text-xs">Trending</span>
    </a>
    <a href="#" class="text-center">
      <svg class="w-6 h-6 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
</svg>
      <span class="text-xs">Subscriptions</span>
    </a>
    <a href="tutors.html" class="text-center">
      <svg class="w-6 h-6 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 0 0012 20.055a11.952 0 00-6.824-2.998 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222"/>
</svg>
      <span class="text-xs">Tutors</span>
    </a>
    <a href="admin-login.php" class="text-center">
      <svg class="w-6 h-6 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l-9-5-9-5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 0 0012 20.055a11.952 0 00-6.824-2.998 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222"/>
</svg>
      <span class="text-xs">Admin</span>
    </a>
  </nav>

  <!-- ðŸ”¹ Main Content -->
  <div class="main-content pt-20 pb-16 px-4 md: px-8 lg:px-12 xl:max-w-7xl mx-auto">
    <!-- Tabs -->
    <div class="flex space-x-4 mb-6">
      <button id="tutors-tab" class="tab-btn active">Tutors</button>
      <button id="posts-tab" class="tab-btn">Posts</button>
    </div>

    <!-- Category Filter -->
    <div class="category-filter flex space-x-2 overflow-x-auto pb-2 mb-6">
      <button class="category-btn bg-gray-600 text-white px-4 py-2 rounded active">All</button>
      <button class="category-btn bg-gray-600 text-white px-4 py-2 rounded">Math</button>
      <button class="category-btn bg-gray-600 text-white px-4 py-2 rounded">Science</button>
      <button class="category-btn bg-gray-600 text-white px-4 py-2 rounded">History</button>
      <button class="category-btn bg-gray-600 text-white px-4 py-2 rounded">Language</button>
    </div>

    <!-- What's on your mind -->
    <div class="mb-6">
      <input type="text" id="mind-input" readonly placeholder="What's on your mind? Share something..." class="w-full" />
    </div>

    <!-- Error Message -->
    <div id="error-message" class="text-red-500 mb-4 hidden"></div>

    <!-- Tutors Container -->
    <div id="tutors-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>

    <!-- Posts Container -->
    <div id="posts-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 hidden"></div>
  </div>

<script src="https://www.gstatic.com/firebasejs/10.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.23.0/firestore-compat.js"></script>
<script>
  // Firebase Configuration
  const firebaseConfig = {
    // Replace with your Firebase config object
    apiKey: "your-api-key",
    authDomain: "your-auth-domain",
    projectId: "your-project-id",
    storageBucket: "your-storage-bucket",
    messagingSenderId: "your-messaging-sender-id",
    appId: "your-app-id"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // DOM Elements
  const menuBtn = document.getElementById('menu-btn');
  const sidebar = document.getElementById('sidebar');
  const searchBar = document.getElementById('search-bar');
  const searchContainer = document.getElementById('search-container');
  const logoContainer = document.getElementById('logo-container');
  const userPic = document.getElementById('user-pic');
  const tutorsContainer = document.getElementById('tutors-container');
  const postsContainer = document.getElementById('posts-container');
  const tutorsTab = document.getElementById('tutors-tab');
  const postsTab = document.getElementById('posts-tab');
  const categoryFilter = document.querySelector('.category-filter');
  const mindInput = document.getElementById('mind-input');
  const codeModal = document.getElementById('code-modal');
  const codeInput = document.getElementById('code-input');
  const modalSubmit = document.getElementById('modal-submit');
  const modalCancel = document.getElementById('modal-cancel');
  const modalError = document.getElementById('modal-error');
  const postModal = document.getElementById('post-modal');
  const postTextInput = document.getElementById('post-text');
  const postImageInput = document.getElementById('post-image');
  const textInputContainer = document.getElementById('text-input-container');
  const imageInputContainer = document.getElementById('image-input-container');
  const postSubmit = document.getElementById('post-submit');
  const postCancel = document.getElementById('post-cancel');
  const postError = document.getElementById('post-error');
  const commentModal = document.getElementById('comment-modal');
  const commentInput = document.getElementById('comment-input');
  const commentList = document.getElementById('comment-list');
  const commentSubmit = document.getElementById('comment-submit');
  const commentCancel = document.getElementById('comment-cancel');
  const commentError = document.getElementById('comment-error');
  const errorMessage = document.getElementById('error-message');
  const loaderOverlay = document.getElementById('loader-overlay');
  const signOutBtn = document.getElementById('sign-out');

  // State
  let currentUser = null;
  let currentPostId = null;

  // Utility Functions
  function showLoader() {
    loaderOverlay.style.display = 'flex';
  }
  function hideLoader() {
    loaderOverlay.style.display = 'none';
  }
  function showError(element, message) {
    element.textContent = message;
    element.classList.remove('hidden');
  }
  function hideError(element) {
    element.classList.add('hidden');
  }
  function getRelativeTime(timestamp) {
    const now = new Date();
    const time = new Date(timestamp);
    const diff = now - time;
    const seconds = Math.floor(diff / 1000);
    const minutes = Math.floor(seconds / 60);
    const hours = Math.floor(minutes / 60);
    const days = Math.floor(hours / 24);
    if (seconds < 60) return 'Just now';
    if (minutes < 60) return `${minutes}m ago`;
    if (hours < 24) return `${hours}h ago`;
    if (days < 7) return `${days}d ago`;
    return time.toLocaleDateString();
  }

  // Sidebar Toggle
  menuBtn.addEventListener('click', () => {
    sidebar.classList.toggle('open');
  });

  // Search Bar Animation
  searchBar.addEventListener('focus', () => {
    searchContainer.classList.add('focused');
    logoContainer.classList.add('hidden');
  });
  searchBar.addEventListener('blur', () => {
    searchContainer.classList.remove('focused');
    logoContainer.classList.remove('hidden');
  });

  // Tab Switching
  tutorsTab.addEventListener('click', () => {
    tutorsTab.classList.add('active');
    postsTab.classList.remove('active');
    tutorsContainer.classList.remove('hidden');
    postsContainer.classList.add('hidden');
    renderTutors();
  });
  postsTab.addEventListener('click', () => {
    postsTab.classList.add('active');
    tutorsTab.classList.remove('active');
    postsContainer.classList.remove('hidden');
    tutorsContainer.classList.add('hidden');
    renderPosts();
  });

  // Category Filter
  categoryFilter.addEventListener('click', (e) => {
    if (e.target.tagName === 'BUTTON') {
      const buttons = categoryFilter.querySelectorAll('button');
      buttons.forEach(btn => btn.classList.remove('active'));
      e.target.classList.add('active');
      const category = e.target.textContent.toLowerCase();
      if (tutorsTab.classList.contains('active')) {
        renderTutors(category);
      } else {
        renderPosts(category);
      }
    }
  });

  // Post Modal
  mindInput.addEventListener('click', () => {
    if (!currentUser) {
      alert('Please sign in to create a post.');
      window.location.href = 'login.html';
      return;
    }
    postModal.style.display = 'flex';
    postTextInput.focus();
  });
  document.querySelectorAll('input[name="post-type"]').forEach(radio => {
    radio.addEventListener('change', (e) => {
      if (e.target.value === 'text') {
        textInputContainer.classList.remove('hidden');
        imageInputContainer.classList.add('hidden');
      } else {
        imageInputContainer.classList.remove('hidden');
        textInputContainer.classList.add('hidden');
      }
    });
  });

  // Modal Close
  modalCancel.addEventListener('click', () => {
    codeModal.style.display = 'none';
    codeInput.value = '';
    hideError(modalError);
  });
  postCancel.addEventListener('click', () => {
    postModal.style.display = 'none';
    postTextInput.value = '';
    postImageInput.value = '';
    hideError(postError);
  });
  commentCancel.addEventListener('click', () => {
    commentModal.style.display = 'none';
    commentInput.value = '';
    hideError(commentError);
  });

  // Render Tutors
  async function renderTutors(category = '') {
    showLoader();
    try {
      const tutorsSnapshot = await db.collection('tutors').get();
      tutorsContainer.innerHTML = '';
      tutorsSnapshot.forEach(doc => {
        const tutor = doc.data();
        if (category === 'all' || !category || tutor.category.toLowerCase() === category) {
          const card = document.createElement('div');
          card.className = 'tutor-card bg-[#212121] rounded-lg p-4 shadow-lg';
          card.innerHTML = `
            <img src="${tutor.image || 'https://via.placeholder.com/150'}" alt="${tutor.name}" class="w-full h-40 object-cover rounded-md mb-4">
            <h3 class="text-lg font-bold">${tutor.name}</h3>
            <p class="text-sm text-gray-400 mb-2">${tutor.category}</p>
            <p class="text-sm mb-4">${tutor.description}</p>
            <button class="btn-pay w-full py-2 rounded-md" data-id="${doc.id}">Pay $${tutor.price}/hr</button>
          `;
          tutorsContainer.appendChild(card);
        }
      });
    } catch (error) {
      showError(errorMessage, 'Failed to load tutors.');
      console.error(error);
    } finally {
      hideLoader();
    }
  }

  // Render Posts
  async function renderPosts(category = '') {
    showLoader();
    try {
      const postsSnapshot = await db.collection('posts').orderBy('timestamp', 'desc').get();
      postsContainer.innerHTML = '';
      postsSnapshot.forEach(doc => {
        const post = doc.data();
        if (category === 'all' || !category || (post.category && post.category.toLowerCase() === category)) {
          const card = document.createElement('div');
          card.className = 'post-card bg-[#212121] rounded-lg p-4 shadow-lg';
          card.innerHTML = `
            <div class="flex items-center mb-4">
              <img src="${post.photoURL || 'https://www.gravatar.com/avatar?d=mp'}" alt="Profile" class="w-10 h-10 rounded-full mr-2">
              <div class="flex items-center">
                <p class="text-base font-semibold">${post.authorName || 'Anonymous'}</p>
                <svg class="w-4 h-4 ml-1 inline-block" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="12" cy="12" r="10" fill="#ff0000"/>
                  <path d="M10 14.586l-3.293-3.293a1 1 0 00-1.414 1.414l4 4a1 1 0 001.414 0l8-8a1.414-1.414l-7.414-1.414L10 14.586z" fill="#fff"/>
</svg>
              </div>
              <p class="text-sm text-gray-400 ml-auto">${getRelativeTime(post.timestamp)}</p>
            </div>
            ${post.type === 'image' ? `<img src="${post.image}" alt="Post Image" class="w-full post-image object-cover rounded-md mb-4">` : `<p class="text-sm mb-4">${post.content}</p>`}
            <div class="post-actions flex space-x-4">
              <button class="btn-like flex items-center space-x-1" data-id="${doc.id}">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 4.318l4.5 4.5 3 3 4.5-4.5A4.5 4.5 0 0116.5 3c1.243 0 2.378.505 3.182 1.318l.5.5A4.5 4.5 0 0121 7.5c0 1.243-.505 2.378-1.318 3.182l-5 5a1 1 0 01-1.414 0l-5-5A2.828 2.828 0 017 7.5c0-.621.252-1.182.659-1.591z"/>
</svg>
                <span>${post.likes ? post.likes.length : 0}</span>
              </button>
              <button class="btn-comment flex items-center space-x-1" data-id="${doc.id}">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5l-2 2V4a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2h-4l-2 2z"/>
</svg>
                <span>${post.comments ? post.comments.length : 0}</span>
              </button>
            </div>
          `;
          postsContainer.appendChild(card);
          if (post.likes && post.likes.includes(currentUser?.uid)) {
            card.querySelector('.btn-like').classList.add('liked');
          }
        }
      });
    } catch (error) {
      showError(errorMessage, 'Failed to load posts.');
      console.error(error);
    } finally {
      hideLoader();
    }
  }

  // Post Submission
  postSubmit.addEventListener('click', async () => {
    if (!currentUser) {
      alert('Please sign in to create a post.');
      postModal.style.display = 'none';
      window.location.href = 'login.html';
      return;
    }
    const postType = document.querySelector('input[name="post-type"]:checked').value;
    const content = postType === 'text' ? postTextInput.value.trim() : postImageInput.value.trim();
    if (!content) {
      showError(postError, `Please enter a ${postType === 'text' ? 'post' : 'valid image URL'}.`);
      return;
    }
    showLoader();
    try {
      const userDoc = await db.collection('users').doc(currentUser.uid).get();
      const userData = userDoc.data();
      await db.collection('posts').add({
        type: postType,
        [postType === 'text' ? 'content' : 'image']: content,
        authorEmail: currentUser.email,
        authorName: userData?.name || 'Anonymous',
        uid: currentUser.uid,
        photoURL: userData?.photoURL || currentUser.photoURL || 'https://www.gravatar.com/avatar?d=mp',
        timestamp: Date.now(),
        likes: [],
        comments: []
      });
      postModal.style.display = 'none';
      postTextInput.value = '';
      postImageInput.value = '';
      hideError(postError);
      renderPosts();
    } catch (error) {
      showError(postError, 'Failed to create post.');
      console.error(error);
    } finally {
      hideLoader();
    }
  });

  // Like Post
  postsContainer.addEventListener('click', async (e) => {
    if (e.target.closest('.btn-like')) {
      if (!currentUser) {
        alert('Please sign in to like posts.');
        window.location.href = 'login.html';
        return;
      }
      const btn = e.target.closest('.btn-like');
      const postId = btn.dataset.id;
      showLoader();
      try {
        const postRef = db.collection('posts').doc(postId);
        const postDoc = await postRef.get();
        const likes = postDoc.data().likes || [];
        if (likes.includes(currentUser.uid)) {
          await postRef.update({
            likes: firebase.firestore.FieldValue.arrayRemove(currentUser.uid)
          });
          btn.classList.remove('liked');
        } else {
          await postRef.update({
            likes: firebase.firestore.FieldValue.arrayUnion(currentUser.uid)
          });
          btn.classList.add('liked');
        }
        renderPosts();
      } catch (error) {
        showError(errorMessage, 'Failed to like post.');
        console.error(error);
      } finally {
        hideLoader();
      }
    }
  });

  // Comment Post
  postsContainer.addEventListener('click', async (e) => {
    if (e.target.closest('.btn-comment')) {
      if (!currentUser) {
        alert('Please sign in to comment on posts.');
        window.location.href = 'login.html';
        return;
      }
      const postId = e.target.closest('.btn-comment').dataset.id;
      currentPostId = postId;
      commentModal.style.display = 'flex';
      commentInput.focus();
      showLoader();
      try {
        const postDoc = await db.collection('posts').doc(postId).get();
        const comments = postDoc.data().comments || [];
        commentList.innerHTML = '';
        for (const comment of comments) {
          const userDoc = await db.collection('users').doc(comment.userId).get();
          const userData = userDoc.data();
          const commentEl = document.createElement('div');
          commentEl.className = 'flex items-center space-x-2 mb-2';
          commentEl.innerHTML = `
            <img src="${userData?.photoURL || 'https://www.gravatar.com/avatar?d=mp'}" alt="Profile" class="w-8 h-8 rounded-full">
            <div>
              <p class="text-sm font-medium">${userData?.email || 'Anonymous'}</p>
              <p class="text-sm">${comment.text}</p>
            </div>
          `;
          commentList.appendChild(commentEl);
        }
      } catch (error) {
        showError(commentError, 'Failed to load comments.');
        console.error(error);
      } finally {
        hideLoader();
      }
    }
  });

  // Submit Comment
  commentSubmit.addEventListener('click', async () => {
    if (!currentUser) return;
    const commentText = commentInput.value.trim();
    if (!commentText) {
      showError(commentError, 'Please enter a comment.');
      return;
    }
    showLoader();
    try {
      await db.collection('posts').doc(currentPostId).update({
        comments: firebase.firestore.FieldValue.arrayUnion({
          userId: currentUser.uid,
          text: commentText,
          timestamp: Date.now()
        })
      });
      commentModal.style.display = 'none';
      commentInput.value = '';
      hideError(commentError);
      renderPosts();
    } catch (error) {
      showError(commentError, 'Failed to add comment.');
      console.error(error);
    } finally {
      hideLoader();
    }
  });

  // Code Submission
  modalSubmit.addEventListener('click', async () => {
    const code = codeInput.value.trim();
    if (!code || code.length !== 8) {
      showError(modalError, 'Please enter a valid 8-character code.');
      return;
    }
    showLoader();
    try {
      const codeDoc = await db.collection('codes').doc(code).get();
      if (!codeDoc.exists) {
        showError(modalError, 'Invalid code.');
        hideLoader();
        return;
      }
      const tutorId = codeDoc.data().tutorId;
      window.location.href = `tutor-content.html?id=${tutorId}`;
    } catch (error) {
      showError(modalError, 'Error verifying code.');
      console.error(error);
    } finally {
      hideLoader();
    }
  });

  // Pay Button
  tutorsContainer.addEventListener('click', (e) => {
    if (e.target.classList.contains('btn-pay')) {
      if (!currentUser) {
        alert('Please sign in to proceed with payment.');
        window.location.href = 'login.html';
        return;
      }
      const tutorId = e.target.dataset.id;
      codeModal.style.display = 'flex';
      codeInput.focus();
    }
  });

  // Auth State Listener
  auth.onAuthStateChanged(async (user) => {
    if (user) {
      currentUser = user;
      try {
        const userDoc = await db.collection('users').doc(user.uid).get();
        const userData = userDoc.data();
        userPic.src = userData?.photoURL || user.photoURL || 'https://www.gravatar.com/avatar?d=mp';
        if (!userData) {
          await db.collection('users').doc(user.uid).set({
            email: user.email,
            name: user.displayName || '',
            photoURL: user.photoURL || '',
            bio: ''
          });
        }
        renderTutors();
      } catch (error) {
        console.error('Error fetching user data:', error);
        showError(errorMessage, 'Failed to load user data.');
      }
    } else {
      window.location.href = 'login.html';
    }
  });

  // Sign Out
  signOutBtn.addEventListener('click', async () => {
    try {
      await auth.signOut();
      window.location.href = 'login.html';
    } catch (error) {
      showError(errorMessage, 'Failed to sign out.');
      console.error(error);
    }
  });

  // User Profile Picture Click
  userPic.addEventListener('click', () => {
    window.location.href = 'profile.html';
  });

  // Initialize
  renderTutors();
</script>
</body>
</html>
